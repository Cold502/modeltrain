# å‰ç«¯æ ·å¼è°ƒæ•´é€ŸæŸ¥

æœ¬æ–‡è®°å½•äº†è¿‘æœŸåœ¨ `ModelChat.vue` ä¸­è°ƒè¯•æ°”æ³¡æ¶ˆæ¯æ ·å¼æ—¶ç”¨åˆ°çš„ CSS æŠ€å·§ï¼Œä»¥åŠåç»­å¯èƒ½éœ€è¦æ‰©å±•çš„æ“ä½œæ­¥éª¤ï¼Œæ–¹ä¾¿åœ¨å…¶ä»–é¡µé¢å¤ç”¨ã€‚

## 1. æ°”æ³¡æ¶ˆæ¯å¸ƒå±€è¦ç‚¹

- **ç»“æ„å®šä½**ï¼šæ¶ˆæ¯æ–‡æœ¬å®¹å™¨ä½äº `.message-text`ï¼Œå¤–å±‚ `.message-content-wrapper` è´Ÿè´£å®½åº¦ä¸å¯¹é½ï¼ˆç”¨æˆ·æ¶ˆæ¯å³å¯¹é½ï¼ŒåŠ©æ‰‹æ¶ˆæ¯å·¦å¯¹é½ï¼‰ã€‚
- **æœ€å°å°ºå¯¸**ï¼šé€šè¿‡ `min-width: 120px` å’Œ `min-height: 20px` ç¡®ä¿æ°”æ³¡åœ¨å†…å®¹ä¸ºç©ºæˆ–æµå¼è¾“å‡ºå°šæœªè¿”å›æ—¶ä¸ä¼šå¡Œç¼©ã€‚ç©ºå†…å®¹ä¸æµå¼å ä½é¢å¤–è®¾ç½® `min-height: 48px` ä»¥æä¾›æ›´ç¨³å®šçš„å ä½é«˜åº¦ã€‚
- **å†…è¾¹è·**ï¼š`padding: 8px 16px` åœ¨ä¸Šä¸‹æä¾› 8px ç•™ç™½ï¼Œé…åˆ `line-height: 1.5` è·å¾—æ›´è‡ªç„¶çš„æ®µé—´è·ã€‚å¦‚æœéœ€è¦æ›´ç´§å‡‘ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè°ƒå° `padding`ã€‚

```1215:1261:frontend/src/views/ModelChat.vue
.message-text {
  padding: 8px 16px;
  border-radius: 16px;
  background: var(--bg-color);
  border: 1px solid var(--border-color);
  color: var(--text-color);
  line-height: 1.5;
  word-wrap: break-word;
  white-space: normal;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  min-height: 20px;
  min-width: 120px;
}
```

## 2. å¸¸ç”¨ä¼ªç±»ä¸å…³ç³»é€‰æ‹©å™¨

- **ä¼ªç±»ï¼ˆPseudo-classï¼‰**ï¼šç”¨äºè¡¨ç¤ºå…ƒç´ åœ¨ç‰¹å®šçŠ¶æ€ä¸‹çš„æ ·å¼ï¼Œä¾‹å¦‚ `:hover`ï¼ˆé¼ æ ‡æ‚¬åœï¼‰ã€`:focus`ï¼ˆè·å¾—ç„¦ç‚¹ï¼‰ã€`:empty`ï¼ˆå†…å®¹ä¸ºç©ºï¼‰ç­‰ã€‚ä¼ªç±»å†™åœ¨é€‰æ‹©å™¨åæ–¹ï¼Œä»¥å•å†’å· `:` å¼€å¤´ã€‚
- **`:empty` ä¼ªç±»**ï¼šé€‰ä¸­**è‡ªèº«æ²¡æœ‰ä»»ä½•å­èŠ‚ç‚¹**çš„å…ƒç´ ï¼ˆåŒ…æ‹¬æ²¡æœ‰æ–‡æœ¬ã€æ²¡æœ‰å­æ ‡ç­¾ï¼‰ã€‚ç”¨äºç»™å®Œå…¨ç©ºçš„æ°”æ³¡è®¾ç½®å ä½æ ·å¼ã€‚
- **`:has()` å…³ç³»ä¼ªç±»**ï¼šCSS é€‰æ‹©å™¨ Level 4 æ–°å¢ï¼Œç”¨äºæ ¹æ®å­å…ƒç´ /åä»£æ˜¯å¦æ»¡è¶³æ¡ä»¶æ¥åŒ¹é…çˆ¶çº§ã€‚è¯­æ³•ä¸º `selector:has(child-selector)`ï¼Œåªè¦æ‹¬å·ä¸­çš„é€‰æ‹©å™¨åœ¨è¯¥å…ƒç´ å†…éƒ¨å‘½ä¸­ï¼Œå°±ä¸ºçˆ¶çº§åº”ç”¨æ ·å¼ã€‚æœ¬é¡¹ç›®ä¸­ç”¨æ¥æ•æ‰â€œæ°”æ³¡å†…å‡ºç°ç©ºå…ƒç´ â€çš„åœºæ™¯ï¼š

```1230:1237:frontend/src/views/ModelChat.vue
.message-text:empty,
.message-text:has(*:empty) {
  min-height: 48px;
  min-width: 120px;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}
```

- **ä¼ªå…ƒç´ ï¼ˆPseudo-elementï¼‰**ï¼šç”¨äºé€‰æ‹©å…ƒç´ å†…éƒ¨â€œè™šæ‹Ÿçš„â€å­èŠ‚ç‚¹ï¼Œä¾‹å¦‚æ–‡æœ¬ç¬¬ä¸€è¡Œã€é¦–å­—æ¯æˆ–æ’å…¥é¢å¤–è£…é¥°ã€‚è¯­æ³•ä»¥åŒå†’å· `::` å¼€å¤´ï¼Œä¾‹å¦‚ `::before`ã€`::after`ã€`::first-line`ã€‚
- **ç¤ºä¾‹ï¼šåŠ è½½åŠ¨ç”»ç‚¹**

```1238:1246:frontend/src/views/ModelChat.vue
.message-item.assistant .message-text:empty::after {
  content: "";
  width: 8px;
  height: 8px;
  background: var(--primary-blue);
  border-radius: 50%;
  animation: pulse 1.5s ease-in-out infinite;
  position: absolute;
}
```

è¿™é‡Œçš„ `::after` æ˜¯ä¼ªå…ƒç´ ï¼Œç”¨äºåœ¨æ°”æ³¡å†…ç”Ÿæˆä¸€ä¸ªå°åœ†ç‚¹å¹¶æ·»åŠ å‘¼å¸åŠ¨ç”»ï¼Œè®©â€œç”Ÿæˆä¸­â€çš„çŠ¶æ€æ›´ç›´è§‚ã€‚

- **æ®µè½é—´è·å¤„ç†**ï¼šç›®å‰æ¶ˆæ¯æ°”æ³¡ä¸­çš„ Markdown æ®µè½ç»Ÿä¸€è®¾ç½® `margin: 0.5em;`ï¼ˆè§ `.message-text :deep(p)`ï¼‰ã€‚`:deep()` æ˜¯ Vue SFC scoped æ ·å¼é‡Œçš„â€œæ·±åº¦é€‰æ‹©å™¨â€ï¼Œå¯è®©æˆ‘ä»¬é€‰ä¸­æ’æ§½/å­ç»„ä»¶æ¸²æŸ“å‡ºçš„çœŸå® DOMï¼ˆä¾‹å¦‚ Markdown ç”Ÿæˆçš„ `<p>`ï¼‰ã€‚å¦‚æœä¸ä½¿ç”¨ `scoped`ï¼Œå•æ–‡ä»¶ç»„ä»¶ `<style>` å—ä¼šåœ¨æ„å»ºæ—¶è¢«ç›´æ¥æ‰“åŒ…æˆå…¨å±€æ ·å¼ï¼ˆæ²¡æœ‰é¢å¤–å‰ç¼€ï¼‰ï¼Œæµè§ˆå™¨åŠ è½½åä¼šå½±å“ä»»æ„åŒåå…ƒç´ ï¼Œè¿™å°±æ˜¯â€œæ±¡æŸ“â€çš„æ ¹æºã€‚åŠ ä¸Š `scoped` åï¼Œç¼–è¯‘å™¨ä¼šç»™å½“å‰ç»„ä»¶çš„ DOM èŠ‚ç‚¹å’Œ CSS é€‰æ‹©å™¨è¡¥å……ä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸Œå±æ€§ï¼ˆä¾‹å¦‚ `data-v-xxxx`ï¼‰ï¼Œä»è€Œè®©æ ·å¼ä»…åœ¨ç»„ä»¶å†…éƒ¨ç”Ÿæ•ˆã€‚è‹¥åç»­éœ€è¦æ”¯æŒå¤šæ®µè¾“å‡ºï¼Œå¯ä»¥æ”¹å› `margin: 0` å¹¶æŒ‰éœ€è¦æ·»åŠ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆå¦‚ `p + p`ï¼‰æ§åˆ¶æ®µè½é—´è·ï¼›`p + p` è¡¨ç¤ºâ€œç´§è·Ÿå‰ä¸€ä¸ª `<p>` çš„æ®µè½â€ï¼Œä¹Ÿå«å…„å¼Ÿç›¸é‚»é€‰æ‹©å™¨ã€‚

## é™„å½•ï¼šå¯¹è±¡å±•å¼€è¿ç®—ç¬¦ `...`

- **åŸºæœ¬æ¦‚å¿µ**ï¼š`...obj` æ˜¯ ES2018 å¼•å…¥çš„ Object Spread è¯­æ³•ï¼Œç”¨äºå°†å¯¹è±¡çš„å¯æšä¸¾å±æ€§æµ…æ‹·è´åˆ°æ–°å¯¹è±¡ã€‚å¸¸è§ç”¨æ³•æ˜¯å¤åˆ¶åŸæœ‰å­—æ®µçš„åŒæ—¶è¦†ç›–/æ–°å¢æŸäº›å€¼ã€‚
- **ç¤ºä¾‹ï¼šé‡ç½®æ¶ˆæ¯çŠ¶æ€**

```399:407:frontend/src/views/ModelChat.vue
sessionDetail.messages = sessionDetail.messages.map(message => {
  return {
    ...message,
    isStreaming: false
  }
});
```

è¿™æ®µä»£ç åœ¨åŠ è½½å†å²ä¼šè¯æ—¶å°†æ¯æ¡æ¶ˆæ¯æ‹·è´ä¸€ä»½ï¼Œå¹¶æŠŠ `isStreaming` ç»Ÿä¸€è®¾ä¸º `false`ï¼Œé¿å…ç›´æ¥ä¿®æ”¹åŸå§‹å“åº”å¼æ•°æ®ï¼Œä¹Ÿé˜²æ­¢æ—§çš„â€œæµå¼â€çŠ¶æ€æ®‹ç•™ã€‚å¯¹è±¡å±•å¼€åŒæ ·é€‚ç”¨äºå‡½æ•°å…¥å‚ã€çŠ¶æ€æ›´æ–°ç­‰åœºæ™¯ï¼Œæ˜¯ React/Vue ç­‰å‰ç«¯æ¡†æ¶é‡Œéå¸¸å¸¸è§çš„å†™æ³•ã€‚

## æ¨¡å‹å¯¹è¯ï¼ˆæµå¼å¤„ç†ï¼‰æµç¨‹æ¢³ç†

ä»¥ä¸‹å†…å®¹æ€»ç»“è‡ª `frontend/src/views/ModelChat.vue`ï¼Œæè¿°ä¸€æ¬¡å®Œæ•´çš„æ¨¡å‹å¯¹è¯ï¼ˆå«æµå¼è¾“å‡ºï¼‰åœ¨å‰ç«¯çš„å¤„ç†æ­¥éª¤ï¼Œå¹¶è§£é‡Šå…³é”®å˜é‡ã€è¯·æ±‚å’ŒçŠ¶æ€ã€‚

1. **å‘é€å‰å‡†å¤‡**
   - ç»„ä»¶é€šè¿‡ `selectedModel`ã€`selectedPrompt` è®°å½•å½“å‰é€‰æ‹©çš„æ¨¡å‹åŠæç¤ºè¯ï¼›è¾“å…¥æ¡†å†…å®¹å­˜æ”¾åœ¨ `inputMessage`ã€‚
   - `sendMessage` ä¸­å…ˆåšåŸºæœ¬æ ¡éªŒï¼šè¾“å…¥éç©ºã€æ²¡æœ‰æ­£åœ¨æµå¼ä¸­çš„æ¶ˆæ¯ã€æ¨¡å‹å·²é€‰æ‹©ã€‚
   - æ„é€  `userMessage` å¯¹è±¡ï¼š
     ```js
     const userMessage = {
       id: `user-${Date.now()}`,
       role: 'user',
       content: userMessageContent,
       created_at: new Date().toISOString(),
       requestId: crypto.randomUUID ? crypto.randomUUID() : `req-${Date.now()}`
     }
     ```
     å…¶ä¸­ `requestId` ä¸ºæœ¬åœ°å”¯ä¸€æ ‡è¯†ï¼Œæ–¹ä¾¿åç»­å…³è”åˆ°è¿™æ¬¡æ¨¡å‹è¯·æ±‚ã€‚

2. **æœ¬åœ°é¢„è§ˆä¸è½åº“**
   - å°† `userMessage` æ¨å…¥ `currentSession.value.messages`ï¼Œç«‹å³åœ¨ç•Œé¢å±•ç¤ºï¼›
   - è‹¥å½“å‰ä¼šè¯æ²¡æœ‰ IDï¼Œå…ˆè°ƒç”¨ `chatAPI.createSession` åˆ›å»ºä¼šè¯å¹¶åˆ·æ–°ä¾§è¾¹æ ï¼›
   - è°ƒç”¨ `chatAPI.sendMessage`ï¼Œé™„å¸¦ `session_id`ã€`role: 'user'`ã€`content` ç­‰ï¼Œå°†ç”¨æˆ·æ¶ˆæ¯å†™å…¥åç«¯æ•°æ®åº“ï¼Œå¹¶æŠŠæ¥å£è¿”å›çš„çœŸå® ID å›å†™åˆ° `userMessage.id`ã€‚

3. **ç»„è£…æ¨¡å‹è¯·æ±‚ä½“**
   - æŒ‰é¡ºåºæ„é€  `messages` æ•°ç»„ï¼šè‹¥é€‰æ‹©äº†æç¤ºè¯å…ˆæ¨å…¥ `system` æ¶ˆæ¯ï¼Œå†æ¨å…¥æœ¬æ¬¡ç”¨æˆ·å†…å®¹ï¼›
   - ç»„è£… `requestData = { model_config_id, messages }`ï¼Œç”¨äºæ™®é€šå¯¹è¯æˆ–æµå¼å¯¹è¯è°ƒç”¨ã€‚

- **è¡¥å……ï¼š`crypto.randomUUID ? ... : ...`**
  
  åœ¨ `sendMessage` é‡Œç”Ÿæˆ `requestId` æ—¶ç”¨åˆ°äº† **ä¸‰å…ƒè¿ç®—ç¬¦** ä¸ **æ¨¡æ¿å­—ç¬¦ä¸²**ï¼š
  
  ```671:680:frontend/src/views/ModelChat.vue
  const userMessage = {
    ...,
    requestId: crypto.randomUUID ? crypto.randomUUID() : `req-${Date.now()}`
  }
  ```
  
  - `æ¡ä»¶ ? A : B` æ˜¯ JavaScript çš„ä¸‰å…ƒï¼ˆæ¡ä»¶ï¼‰è¿ç®—ç¬¦ï¼Œæ¡ä»¶ä¸ºçœŸæ‰§è¡Œ Aï¼Œä¸ºå‡æ‰§è¡Œ Bã€‚
  - è¿™é‡Œæ¡ä»¶æ˜¯æµè§ˆå™¨æ˜¯å¦æ”¯æŒ `crypto.randomUUID`ï¼Œè‹¥æ”¯æŒå°±ç›´æ¥ç”Ÿæˆæ­£å¼ UUIDï¼›å¦åˆ™é€€åŒ–ä¸ºå­—ç¬¦ä¸² `req-æ—¶é—´æˆ³`ï¼ˆæ¨¡æ¿å­—ç¬¦ä¸²é€šè¿‡ `` `req-${Date.now()}` `` æ’å…¥å½“å‰æ¯«ç§’æ—¶é—´ï¼‰ã€‚
  - è¿™æ ·èƒ½ä¿è¯æ— è®ºç¯å¢ƒæ˜¯å¦æ”¯æŒ Web Cryptoï¼Œéƒ½èƒ½å¾—åˆ°ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚

4. **æ¨¡å‹å“åº”ï¼ˆæ™®é€š / æµå¼ï¼‰**
   - è‹¥å…³é—­æµå¼ï¼šç›´æ¥ `POST /api/chat/`ï¼Œè§£æè¿”å›æ–‡æœ¬ï¼›
   - è‹¥å¼€å¯æµå¼ï¼šè°ƒç”¨ `handleStreamingResponse`ï¼ŒSSE ä¼šä¸æ–­è§¦å‘ `onChunk` æ›´æ–° UIï¼Œæœ€ååœ¨ `onComplete` å›è°ƒé‡Œæ‹¿åˆ°å®Œæ•´çš„ `finalContent`ã€‚

5. **åœ¨åå°ä¿å­˜æ¨¡å‹å›å¤**
   - æ— è®ºæ˜¯å¦åœ¨å½“å‰ä¼šè¯ï¼Œ`originalResponseContent` éƒ½ä¼šè®°å½•æ¨¡å‹æœ€ç»ˆè¾“å‡ºï¼›
   - åœ¨ä»£ç æ”¶å°¾é˜¶æ®µï¼š
     ```js
     if (originalResponseContent) {
       await chatAPI.sendMessage({
         session_id: originalSessionId,
         content: originalResponseContent,
         role: 'assistant',
         model_name: selectedModel.value || 'unknown'
       })
     }
     ```
     ä»¥ `assistant` è§’è‰²å†™å…¥æ•°æ®åº“ã€‚å³ä½¿ç”¨æˆ·ä¸­é€”è·³èµ°ï¼Œè¯¥è¯·æ±‚ä»ä¼šåœ¨åå°å®Œæˆï¼Œå†å²è®°å½•ä¿æŒå®Œæ•´ã€‚

6. **ä¼šè¯åˆ‡æ¢ä¸çŠ¶æ€æ¢å¤**
   - é‡æ–°æ‰“å¼€æŸä¸ªä¼šè¯æ—¶ï¼Œ`selectSession` ä¼šé€šè¿‡ `/api/chat/sessions/{id}` è·å–å®Œæ•´æ¶ˆæ¯åˆ—è¡¨ï¼›
   - ä¸ºé¿å…æ¢å¤æ—¶ä»æ˜¾ç¤ºâ€œæ­£åœ¨æµå¼â€ï¼Œæˆ‘ä»¬å°†æ¯æ¡æ¶ˆæ¯ç»Ÿä¸€å±•å¼€å¹¶è®¾ç½® `isStreaming: false`ï¼š
     ```js
     sessionDetail.messages = sessionDetail.messages.map(message => ({
       ...message,
       isStreaming: false
     }))
     ```
   - è‹¥éœ€è¦ç»§ç»­æ˜¾ç¤ºåå°ç”ŸæˆçŠ¶æ€ï¼Œå¯ä»¥é¢å¤–å­˜å‚¨çŠ¶æ€å­—æ®µæˆ–åœ¨ SSE å›è°ƒé‡Œå‘é€äº‹ä»¶é€šçŸ¥ã€‚

7. **è§’è‰²æ ‡è¯†ä¸å±•ç¤º**
   - å‰ç«¯æ ¹æ® `message.role` å†³å®šé‡‡ç”¨å·¦/å³æ°”æ³¡ã€ä¸åŒèƒŒæ™¯è‰²ï¼›
   - æ•°æ®åº“ä¿å­˜çš„ `role` ä¹ŸåŒºåˆ† `user`ã€`assistant`ï¼ˆè‹¥éœ€è¦è¿˜å¯æ‰©å±• `system`ï¼‰ã€‚

> å°ç»“ï¼šè¿™ä¸€å¥—æµç¨‹ä¿è¯äº†ç”¨æˆ·å¯ä»¥è‡ªç”±åˆ‡æ¢ä¼šè¯ï¼Œåå°ä»å¼‚æ­¥å®Œæˆç­”å¤å¹¶è½åº“ã€‚å›åˆ°ä¼šè¯æ—¶ï¼Œæ—¢èƒ½çœ‹åˆ°è‡ªå·±çš„æé—®ï¼Œä¹Ÿèƒ½çœ‹åˆ°æ¨¡å‹å®Œæ•´è¾“å‡ºï¼Œä¸ä¼šå‡ºç°å†…å®¹é”™ä½æˆ–ä¸¢å¤±ã€‚

> âš ï¸ æµè§ˆå™¨æ”¯æŒï¼š`:has()` åœ¨ Chrome 105+/Edge/Safari 15.4+ å¯ç”¨ï¼ŒFirefox ç›®å‰å¤„äºå®éªŒé˜¶æ®µã€‚å¦‚æœéœ€è¦å…¼å®¹æ—§æµè§ˆå™¨ï¼Œå¯æ”¹ä¸ºåœ¨æ¨¡æ¿é‡Œæ¸²æŸ“å ä½ç¬¦å…ƒç´ ï¼Œæˆ–é€šè¿‡ JavaScript æ¡ä»¶æ·»åŠ  CSS ç±»ã€‚

## 3. å ä½åŠ¨ç”»ä¸æµå¼æç¤º

- ç©ºæ°”æ³¡é»˜è®¤æ˜¾ç¤ºä¸€ä¸ªå‘¼å¸åŠ¨ç”»ï¼ˆä½¿ç”¨ `@keyframes pulse`ï¼‰ã€‚ç›®æ ‡å…ƒç´ æ˜¯ `.message-item.assistant .message-text:empty::after`ï¼ŒåŠ¨ç”»ä¸º 1.5 ç§’å¾ªç¯ï¼Œé€‚åˆæé†’â€œæ­£åœ¨ç”Ÿæˆä¸­â€ã€‚
- æµå¼è¾“å‡ºæ—¶ Vue ä¼šç»™æ¶ˆæ¯å¯¹è±¡æ ‡è®° `isStreaming`ï¼Œå¹¶åœ¨ HTML ä¸Šé™„åŠ  `.streaming-empty` ç±»ã€‚ç›¸åº”æ ·å¼ä¸­åŒæ ·è®¾ç½® `min-width`ã€`min-height` å¹¶ä½¿ç”¨ `display: flex` æ°´å¹³å‚ç›´å±…ä¸­ã€‚

## 4. è‡ªå®šä¹‰å»ºè®®

1. **ä¿®æ”¹æ°”æ³¡é¢œè‰²**ï¼šåœ¨ `.message-item.user .message-text` ä¸ `.message-item.assistant .message-text` ä¸­è°ƒæ•´èƒŒæ™¯/è¾¹æ¡†å³å¯ã€‚
2. **è°ƒèŠ‚æœ€å¤§å®½åº¦**ï¼šé»˜è®¤ `max-width` è®¾ç½®åœ¨ `.message-content-wrapper` ä¸­ï¼ˆ70%ï¼‰ã€‚è‹¥å¸Œæœ›æ”¯æŒæ›´å®½æ–‡æœ¬ï¼Œå¯è°ƒæ•´è¯¥å€¼æˆ–é’ˆå¯¹ç‰¹å®šå±å¹•è®¾ç½®åª’ä½“æŸ¥è¯¢ã€‚
3. **æ”¯æŒå¤šä¸»é¢˜**ï¼šé¢œè‰²å…¨éƒ¨å¼•ç”¨ CSS å˜é‡ï¼ˆå¦‚ `var(--bg-color)`ï¼‰ï¼Œå¯åœ¨ä¸»é¢˜åˆ‡æ¢æ—¶åœ¨æ ¹èŠ‚ç‚¹æ›´æ–°å˜é‡å€¼ï¼Œé¿å…é‡å¤æ”¹æ ·å¼æ–‡ä»¶ã€‚

## 5. è°ƒè¯•æŠ€å·§

- Chrome DevTools å¿«æ·é”® `Ctrl+Shift+C`/`Cmd+Shift+C` è¿›å…¥å…ƒç´ æ£€æŸ¥æ¨¡å¼ï¼Œå®æ—¶æŸ¥çœ‹ paddingã€marginã€content box ç­‰ä¿¡æ¯ï¼Œå¸®åŠ©å®šä½é«˜åº¦å¼‚å¸¸ã€‚
- ä¿®æ”¹ CSS åè‹¥ä»çœ‹åˆ°æ—§æ ·å¼ï¼Œç¡®ä¿é‡æ–°æ„å»ºæˆ–åˆ·æ–°æµè§ˆå™¨ç¼“å­˜ï¼ˆå¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨ Vite çš„ HMR ä¸€èˆ¬å³å¯ç«‹å³ç”Ÿæ•ˆï¼‰ã€‚
- é‡åˆ°é«˜åº¦æ˜¯å¥‡æ•°æˆ–å°æ•°çš„æƒ…å†µï¼Œä¼˜å…ˆæ£€æŸ¥ padding ä¸ line-height çš„ç»„åˆï¼›å¦‚æœ `white-space: pre-wrap` å‚ä¸è®¡ç®—ï¼Œä¹Ÿä¼šå› ä¸ºæ¢è¡Œä¿ç•™è€Œå‡ºç°é¢å¤–é«˜åº¦ã€‚

---

å¦‚éœ€è¡¥å……æ›´å¤šå¸¸ç”¨æ ·å¼ç‰‡æ®µï¼Œå¯ç»§ç»­å¾€æœ¬æ–‡ä»¶æ·»åŠ ç« èŠ‚ï¼Œå»ºè®®æŒ‰â€œç»„ä»¶/åœºæ™¯â€åˆ’åˆ†ï¼Œæ–¹ä¾¿æ£€ç´¢ã€‚

## é™„å½•ï¼šUA é»˜è®¤æ ·å¼ä¸é•¿åº¦å•ä½ `em`

- **æ®µè½ (`<p>`) é»˜è®¤ margin**ï¼šæµè§ˆå™¨çš„ User Agent æ ·å¼ï¼ˆè‡ªå¸¦çš„åŸºç¡€æ ·å¼è¡¨ï¼‰ä¼šç»™æ®µè½è®¾ç½® `margin-top: 1em; margin-bottom: 1em;`ã€‚è¿™äº›å€¼ç­‰äºå½“å‰å­—ä½“å¤§å°ï¼ˆä¾‹å¦‚å­—ä½“ 16pxï¼Œåˆ™å¤–è¾¹è· 16pxï¼‰ã€‚å¦‚æœä¸è¦†ç›–ï¼Œæ¶ˆæ¯æ°”æ³¡å†…çš„ Markdown `<p>` å°±ä¼šå¤©ç„¶å¸¦ç€ä¸Šä¸‹ 16px ç©ºç™½ã€‚
- **è¦†ç›–æ–¹å¼**ï¼šåœ¨ `ModelChat.vue` ä¸­ä½¿ç”¨ `:deep(p)` æŠŠ margin å½’é›¶ï¼Œå†æŒ‰éœ€æ±‚ä¸ºç›¸é‚»æ®µè½è®¾ç½® `margin-top: 8px`ï¼Œè¿™æ ·é«˜åº¦å°±å®Œå…¨ç”±æˆ‘ä»¬æ§åˆ¶ã€‚
- **`em` å•ä½**ï¼šç›¸å¯¹äºå…ƒç´ è‡ªèº«çš„å­—ä½“å¤§å°ã€‚`1em` è¡¨ç¤º 1 Ã— å½“å‰å­—ä½“å°ºå¯¸ï¼›`0.5em` å°±æ˜¯å­—ä½“çš„ä¸€åŠã€‚å› ä¸ºé»˜è®¤ paragraph margin ç”¨çš„æ˜¯ `1em`ï¼Œæ‰€ä»¥ä¼šéšå­—ä½“è°ƒæ•´è€Œè”åŠ¨ï¼Œå¯¼è‡´æ•´ä½“é«˜åº¦çœ‹èµ·æ¥ä¸ç¨³å®šã€‚æ”¹å†™ä¸ºå›ºå®šåƒç´ æˆ–ç‰¹å®šè®¾è®¡å€¼èƒ½è®©å¸ƒå±€æ›´å¯æ§ã€‚

## Map æ•°æ®ç»“æ„ä¸æµå¼å“åº”çŠ¶æ€ç®¡ç†

### Map åŸºç¡€æ¦‚å¿µ

`Map` æ˜¯ JavaScript ES6 å¼•å…¥çš„**å†…ç½®é”®å€¼å¯¹é›†åˆ**ï¼Œç±»ä¼¼äºå­—å…¸æˆ–å“ˆå¸Œè¡¨ï¼š

- **é”®å€¼å¯¹å­˜å‚¨**ï¼šæ¯ä¸ªé”®ï¼ˆkeyï¼‰å”¯ä¸€å¯¹åº”ä¸€ä¸ªå€¼ï¼ˆvalueï¼‰ï¼Œé€šè¿‡é”®å¿«é€ŸæŸ¥æ‰¾å€¼
- **ä»»æ„ç±»å‹é”®**ï¼šä¸æ™®é€šå¯¹è±¡ `{}` ä¸åŒï¼ŒMap çš„é”®å¯ä»¥æ˜¯**ä»»æ„ç±»å‹**ï¼ˆæ•°å­—ã€å¯¹è±¡ã€å‡½æ•°ç­‰ï¼‰
- **ä¿æŒæ’å…¥é¡ºåº**ï¼šMap ä¼šä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºï¼Œéå†æ—¶æŒ‰æ’å…¥é¡ºåºè¿”å›

### Map å¸¸ç”¨æ–¹æ³•

```js
const map = new Map()

// 1. è®¾ç½®é”®å€¼å¯¹
map.set('session-123', { id: 'msg-1', content: 'Hello' })

// 2. è·å–å€¼
const value = map.get('session-123')  // { id: 'msg-1', content: 'Hello' }

// 3. æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
if (map.has('session-123')) {
  console.log('ä¼šè¯123å­˜åœ¨æµå¼å“åº”')
}

// 4. åˆ é™¤é”®å€¼å¯¹
map.delete('session-123')

// 5. è·å–å¤§å°
console.log(map.size)  // å½“å‰é”®å€¼å¯¹æ•°é‡

// 6. æ¸…ç©ºæ‰€æœ‰
map.clear()
```

### åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ï¼šè·Ÿè¸ªæµå¼å“åº”

åœ¨ `ModelChat.vue` ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Map` æ¥è·Ÿè¸ªæ¯ä¸ªä¼šè¯æ­£åœ¨è¿›è¡Œçš„æµå¼å“åº”ï¼š

```js
// åœ¨ setup() ä¸­å£°æ˜
const activeStreamingMessages = new Map() // sessionId -> { messageId, message }

// å¼€å§‹æµå¼å“åº”æ—¶è®°å½•
activeStreamingMessages.set(sessionId, {
  messageId: assistantMessageId,
  message: assistantMessage
});

// æµå¼æ›´æ–°æ—¶ä¿®æ”¹å†…å®¹
const streamingInfo = activeStreamingMessages.get(sessionId);
if (streamingInfo) {
  streamingInfo.message.content = parsed.content;
  streamingInfo.message.thinking = parsed.thinking;
}

// æµå¼å®Œæˆæˆ–å‡ºé”™æ—¶æ¸…é™¤
activeStreamingMessages.delete(sessionId);

// åˆ‡æ¢å›ä¼šè¯æ—¶æ£€æŸ¥å¹¶æ¢å¤
const streamingInfo = activeStreamingMessages.get(session.id);
if (streamingInfo) {
  // æ¢å¤æ­£åœ¨è¿›è¡Œçš„æµå¼æ¶ˆæ¯
  sessionDetail.messages.push(streamingInfo.message);
}
```

### ä¸ºä»€ä¹ˆç”¨ Map è€Œä¸æ˜¯æ™®é€šå¯¹è±¡ï¼Ÿ

| ç‰¹æ€§ | `Map` | æ™®é€šå¯¹è±¡ `{}` |
|------|-------|--------------|
| é”®ç±»å‹ | ä»»æ„ç±»å‹ï¼ˆæ•°å­—ã€å¯¹è±¡ç­‰ï¼‰ | åªèƒ½æ˜¯å­—ç¬¦ä¸²/Symbol |
| é”®æŸ¥æ‰¾ | `map.has(key)` è¯­ä¹‰æ¸…æ™° | éœ€è¦ `key in obj` æˆ– `obj.hasOwnProperty` |
| è·å–å¤§å° | `map.size` ç›´æ¥è·å– | éœ€è¦ `Object.keys(obj).length` |
| åˆ é™¤é”® | `map.delete(key)` | `delete obj[key]` |
| æ€§èƒ½ | é¢‘ç¹å¢åˆ æ€§èƒ½æ›´å¥½ | é™æ€ç»“æ„æ›´å¿« |
| éå† | `map.forEach()` æˆ– `for...of` | `for...in` æˆ– `Object.keys()` |

---

## å®Œæ•´çš„å¯¹è¯æµç¨‹ä¸ä¼šè¯åˆ‡æ¢é€»è¾‘

### è®¾è®¡ç›®æ ‡

1. **ç”¨æˆ·å¯ä»¥åœ¨æ¨¡å‹å›å¤æœŸé—´åˆ‡æ¢åˆ°å…¶ä»–ä¼šè¯**ï¼Œä¸ä¼šè¢«é˜»å¡
2. **æµå¼å“åº”åœ¨åå°ç»§ç»­è¿›è¡Œ**ï¼Œå³ä½¿ç”¨æˆ·ç¦»å¼€äº†å½“å‰ä¼šè¯
3. **åˆ‡æ¢å›åŸä¼šè¯æ—¶è‡ªåŠ¨æ¢å¤æ˜¾ç¤º**æ­£åœ¨è¿›è¡Œçš„æµå¼è¾“å‡º
4. **æµå¼å®Œæˆåä¿å­˜åˆ°æ•°æ®åº“**ï¼Œæ— è®ºç”¨æˆ·æ˜¯å¦è¿˜åœ¨è¯¥ä¼šè¯
5. **é¿å…é‡å¤åˆ›å»ºä¼šè¯**ï¼Œç¡®ä¿ä¸€æ¡æ¶ˆæ¯åªåˆ›å»ºä¸€ä¸ªä¼šè¯

### æ ¸å¿ƒé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šé€šè¿‡ç´¢å¼•æ›´æ–°æ¶ˆæ¯å¯¼è‡´é”™ä½

**é—®é¢˜æè¿°**ï¼š
```js
// âŒ é”™è¯¯åšæ³•ï¼šé€šè¿‡æ•°ç»„æœ«å°¾ç´¢å¼•æ›´æ–°
const messageIndex = currentSession.value.messages.length - 1;
currentSession.value.messages[messageIndex].content = newContent;
```

å½“ç”¨æˆ·åˆ‡æ¢ä¼šè¯åï¼Œ`currentSession.value.messages` å˜æˆäº†å…¶ä»–ä¼šè¯çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œç´¢å¼•å°±æŒ‡å‘äº†é”™è¯¯çš„æ¶ˆæ¯ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šé€šè¿‡å”¯ä¸€IDæŸ¥æ‰¾æ¶ˆæ¯

```js
// âœ… æ­£ç¡®åšæ³•ï¼šç”Ÿæˆå”¯ä¸€IDå¹¶é€šè¿‡IDæŸ¥æ‰¾
const assistantMessageId = `assistant-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

const findMessageById = (messages, id) => {
  return messages.findIndex(msg => msg.id === id);
};

// æ›´æ–°æ—¶é€šè¿‡IDæŸ¥æ‰¾
const messageIndex = findMessageById(currentSession.value.messages, assistantMessageId);
if (messageIndex !== -1) {
  currentSession.value.messages[messageIndex].content = newContent;
}
```

#### é—®é¢˜2ï¼šåˆ‡æ¢ä¼šè¯åæ— æ³•ç»§ç»­æ¥æ”¶æµå¼å†…å®¹

**é—®é¢˜æè¿°**ï¼š
æµå¼å“åº”çš„ `onChunk` å›è°ƒåªåœ¨ `currentSession.value.id === sessionId` æ—¶æ›´æ–°UIï¼Œåˆ‡æ¢åå°±çœ‹ä¸åˆ°å†…å®¹äº†ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Map åœ¨åå°æŒç»­æ›´æ–°

```js
// onChunk å›è°ƒä¸­ï¼šå…ˆæ›´æ–° Mapï¼Œå†æ ¹æ®ä¼šè¯IDå†³å®šæ˜¯å¦æ›´æ–°UI
(currentContent) => {
  const parsed = parseThinkingContent(currentContent);
  
  // 1. æ›´æ–° activeStreamingMessagesï¼ˆåå°æŒç»­æ›´æ–°ï¼‰
  const streamingInfo = activeStreamingMessages.get(sessionId);
  if (streamingInfo) {
    streamingInfo.message.content = parsed.content;
    streamingInfo.message.thinking = parsed.thinking;
  }
  
  // 2. åªåœ¨å½“å‰ä¼šè¯æ—¶æ›´æ–°UI
  if (currentSession.value.id === sessionId) {
    const messageIndex = findMessageById(currentSession.value.messages, assistantMessageId);
    if (messageIndex !== -1) {
      currentSession.value.messages[messageIndex] = {
        ...currentSession.value.messages[messageIndex],
        content: parsed.content,
        thinking: parsed.thinking,
        isStreaming: true
      };
      scrollToBottom();
    }
  }
}
```

#### é—®é¢˜3ï¼šåˆ‡æ¢å›ä¼šè¯æ—¶æµå¼æ¶ˆæ¯ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ `selectSession` ä¸­æ£€æŸ¥å¹¶æ¢å¤

```js
const selectSession = async (session) => {
  // 1. ä»æ•°æ®åº“åŠ è½½å†å²æ¶ˆæ¯
  const response = await chatAPI.getSession(session.id);
  const sessionDetail = response.data;
  
  // 2. é‡ç½®æ‰€æœ‰å†å²æ¶ˆæ¯çš„æµå¼çŠ¶æ€
  sessionDetail.messages = sessionDetail.messages.map(message => ({
    ...message,
    isStreaming: false
  }));
  
  // 3. æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨è¿›è¡Œçš„æµå¼å“åº”
  const streamingInfo = activeStreamingMessages.get(session.id);
  if (streamingInfo) {
    // æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦å·²åœ¨åˆ—è¡¨ä¸­
    const existingIndex = sessionDetail.messages.findIndex(
      msg => msg.id === streamingInfo.messageId
    );
    if (existingIndex === -1) {
      // å¦‚æœä¸åœ¨ï¼Œæ·»åŠ æ­£åœ¨æµå¼çš„æ¶ˆæ¯
      sessionDetail.messages.push(streamingInfo.message);
      console.log('ğŸ”„ æ¢å¤æ­£åœ¨è¿›è¡Œçš„æµå¼å“åº”');
    }
  }
  
  currentSession.value = sessionDetail;
  await nextTick();
  scrollToBottom();
};
```

#### é—®é¢˜4ï¼šæ¨¡å‹è¾“å‡ºå®Œæˆåå¤šå‡ºç©ºä¼šè¯

**é—®é¢˜æè¿°**ï¼š
ä»£ç ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹åˆ›å»ºä¼šè¯ï¼Œå¯¼è‡´é‡å¤åˆ›å»ºï¼š
1. å‘é€ç”¨æˆ·æ¶ˆæ¯å‰åˆ›å»ºä¼šè¯ï¼ˆæ­£ç¡®ï¼‰
2. ä¿å­˜AIå›å¤æ—¶å†æ¬¡æ£€æŸ¥å¹¶åˆ›å»ºä¼šè¯ï¼ˆé”™è¯¯ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆ é™¤ç¬¬äºŒä¸ªåˆ›å»ºé€»è¾‘

```js
// âœ… åªåœ¨å‘é€ç”¨æˆ·æ¶ˆæ¯å‰åˆ›å»ºä¼šè¯ä¸€æ¬¡
try {
  if (!originalSessionId) {
    const title = userMessageContent.length > 20
      ? userMessageContent.substring(0, 20) + '...'
      : userMessageContent;
    const sessionResponse = await chatAPI.createSession({ title });
    originalSessionId = sessionResponse.data.id;
    currentSession.value.id = originalSessionId;
    await loadSessions(); // åˆ·æ–°ä¾§è¾¹æ åˆ—è¡¨
  }

  // ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
  await chatAPI.sendMessage({
    session_id: originalSessionId,
    content: userMessageContent,
    role: 'user',
    model_name: selectedModel.value
  });
} catch (error) {
  console.error('ä¿å­˜ç”¨æˆ·æ¶ˆæ¯å¤±è´¥:', error);
  return;
}

// ... æµå¼å“åº”å¤„ç† ...

// âœ… AIå›å¤ä¿å­˜ï¼šä¸å†æ£€æŸ¥ currentSession.value.id
try {
  if (originalResponseContent) {
    await chatAPI.sendMessage({
      session_id: originalSessionId,  // ä½¿ç”¨ä¿å­˜çš„åŸå§‹ä¼šè¯ID
      content: originalResponseContent,
      role: 'assistant',
      model_name: selectedModel.value
    });
    await loadSessions(); // åˆ·æ–°åˆ—è¡¨ä»¥æ›´æ–°æ—¶é—´æˆ³
  }
} catch (error) {
  console.error('ä¿å­˜AIå›å¤å¤±è´¥:', error);
}
```

### å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·å‘é€æ¶ˆæ¯                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æ ¡éªŒï¼šéç©ºã€æ¨¡å‹å·²é€‰ã€æ— æ­£åœ¨æµå¼çš„æ¶ˆæ¯                           â”‚
â”‚ - ç”Ÿæˆ userMessage (å¸¦ requestId)                                â”‚
â”‚ - ç«‹å³æ¨å…¥ currentSession.messages æ˜¾ç¤º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆ›å»ºä¼šè¯ï¼ˆå¦‚æœæ˜¯æ–°ä¼šè¯ï¼‰                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ if (!originalSessionId) {                                       â”‚
â”‚   - è°ƒç”¨ chatAPI.createSession({ title })                       â”‚
â”‚   - ä¿å­˜ originalSessionId = response.data.id                   â”‚
â”‚   - æ›´æ–° currentSession.value.id                                â”‚
â”‚   - åˆ·æ–°ä¾§è¾¹æ åˆ—è¡¨ loadSessions()                                â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ°æ•°æ®åº“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - è°ƒç”¨ chatAPI.sendMessage({ session_id, role: 'user', ... })  â”‚
â”‚ - æ›´æ–° userMessage.id = savedUserMessage.data.id               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å‘èµ·æµå¼å“åº”                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ç”Ÿæˆå”¯ä¸€ assistantMessageId                                    â”‚
â”‚ - åˆ›å»ºç©ºçš„ assistantMessage { isStreaming: true }               â”‚
â”‚ - æ¨å…¥ currentSession.messages                                  â”‚
â”‚ - è®°å½•åˆ° Map: activeStreamingMessages.set(sessionId, {...})    â”‚
â”‚ - è°ƒç”¨ createSSEStream() å¼€å§‹æµå¼ä¼ è¾“                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. SSE æµå¼æ¥æ”¶ï¼ˆonChunk å›è°ƒï¼‰                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¯æ¬¡æ”¶åˆ°æ•°æ®å—ï¼š                                                   â”‚
â”‚ 1. è§£æå†…å®¹ parseThinkingContent(currentContent)                â”‚
â”‚ 2. æ›´æ–° Map ä¸­çš„æ¶ˆæ¯ï¼ˆåå°æŒç»­æ›´æ–°ï¼‰                              â”‚
â”‚    streamingInfo.message.content = parsed.content               â”‚
â”‚ 3. å¦‚æœå½“å‰æ˜¾ç¤ºè¯¥ä¼šè¯ï¼ˆcurrentSession.id === sessionIdï¼‰        â”‚
â”‚    - é€šè¿‡ ID æŸ¥æ‰¾æ¶ˆæ¯ç´¢å¼•                                         â”‚
â”‚    - æ›´æ–°ç•Œé¢æ˜¾ç¤º                                                 â”‚
â”‚    - æ»šåŠ¨åˆ°åº•éƒ¨                                                   â”‚
â”‚                                                                 â”‚
â”‚ âš ï¸ å…³é”®ï¼šå³ä½¿ç”¨æˆ·åˆ‡èµ°ï¼ŒMap ä»åœ¨åå°æ›´æ–°                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ ç”¨æˆ·åˆ‡æ¢ä¼šè¯ï¼Ÿ   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           YES â”‚         NO
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ selectSession()    â”‚   â”‚ ç»§ç»­å½“å‰ä¼šè¯     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ 1. åŠ è½½å†å²æ¶ˆæ¯     â”‚            â†“
        â”‚ 2. é‡ç½® isStreaming â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 3. æ£€æŸ¥ Map æ¢å¤    â”‚   â”‚ SSE æµå¼ç»§ç»­     â”‚
        â”‚    æµå¼æ¶ˆæ¯         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â†“
                    â”‚                     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æµå¼å®Œæˆï¼ˆonComplete å›è°ƒï¼‰                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - æ¸…é™¤ Map: activeStreamingMessages.delete(sessionId)          â”‚
â”‚ - å¦‚æœå½“å‰æ˜¾ç¤ºè¯¥ä¼šè¯ï¼šè®¾ç½® isStreaming: false                     â”‚
â”‚ - é€šè¿‡å›è°ƒä¼ é€’ finalContent ç»™ä¸Šå±‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ä¿å­˜ AI å›å¤åˆ°æ•°æ®åº“                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ if (originalResponseContent) {                                  â”‚
â”‚   - è°ƒç”¨ chatAPI.sendMessage({                                  â”‚
â”‚       session_id: originalSessionId,  // ä½¿ç”¨åŸå§‹ä¼šè¯ID          â”‚
â”‚       role: 'assistant',                                        â”‚
â”‚       content: originalResponseContent                          â”‚
â”‚     })                                                          â”‚
â”‚   - åˆ·æ–°ä¼šè¯åˆ—è¡¨ loadSessions() æ›´æ–°æ—¶é—´æˆ³                        â”‚
â”‚ }                                                               â”‚
â”‚                                                                 â”‚
â”‚ âš ï¸ ä¸å†æ£€æŸ¥ currentSession.value.idï¼Œé¿å…é‡å¤åˆ›å»ºä¼šè¯             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ æµç¨‹å®Œæˆ       â”‚
                    â”‚ sending = falseâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“

1. **å”¯ä¸€IDç”Ÿæˆ**ï¼š`assistant-${Date.now()}-${Math.random().toString(36).substr(2, 9)}` ç¡®ä¿æ¶ˆæ¯IDå”¯ä¸€
2. **é€šè¿‡IDæŸ¥æ‰¾**ï¼šé¿å…ä½¿ç”¨æ•°ç»„ç´¢å¼•ï¼Œé˜²æ­¢ä¼šè¯åˆ‡æ¢åé”™ä½
3. **Map çŠ¶æ€ç®¡ç†**ï¼šç”¨ `sessionId` ä½œä¸ºé”®ï¼Œè·Ÿè¸ªæ¯ä¸ªä¼šè¯çš„æµå¼å“åº”
4. **åŒè·¯æ›´æ–°**ï¼š`onChunk` ä¸­åŒæ—¶æ›´æ–° Mapï¼ˆåå°ï¼‰å’Œ UIï¼ˆå½“å‰ä¼šè¯ï¼‰
5. **çŠ¶æ€æ¢å¤**ï¼š`selectSession` æ£€æŸ¥ Map å¹¶æ¢å¤æ­£åœ¨æµå¼çš„æ¶ˆæ¯
6. **å•ç‚¹åˆ›å»ºä¼šè¯**ï¼šåªåœ¨å‘é€ç”¨æˆ·æ¶ˆæ¯å‰åˆ›å»ºä¸€æ¬¡ï¼Œé¿å…é‡å¤
7. **åŸå§‹ä¼šè¯IDä¿å­˜**ï¼šä½¿ç”¨ `originalSessionId` å˜é‡ä¿å­˜ï¼Œç¡®ä¿ä¿å­˜æ—¶ä¸å—ä¼šè¯åˆ‡æ¢å½±å“

---

## é»‘æš—æ¨¡å¼å®ç°åŸç†

### è®¾è®¡æ€è·¯

æœ¬é¡¹ç›®é‡‡ç”¨ **CSS å˜é‡ + ç±»åˆ‡æ¢** çš„æ–¹å¼å®ç°æ—¥é—´/é»‘å¤œæ¨¡å¼æ— ç¼åˆ‡æ¢ï¼Œé¿å…é‡å¤ç¼–å†™æ ·å¼ä»£ç ï¼ŒåŒæ—¶ä¿æŒé«˜å¯ç»´æŠ¤æ€§ã€‚

### æ ¸å¿ƒæ–‡ä»¶

#### 1. é¢œè‰²é…ç½®ï¼š`frontend/src/assets/styles/main.css`

æ‰€æœ‰é¢œè‰²é€šè¿‡ CSS è‡ªå®šä¹‰å±æ€§ï¼ˆCSS Variablesï¼‰å®šä¹‰ï¼š

```css
/* æ—¥é—´æ¨¡å¼ - åœ¨ :root é€‰æ‹©å™¨ä¸­å®šä¹‰ */
:root {
  --primary-blue: #64a8db;        /* ä¸»è‰²è°ƒ */
  --light-blue: #e8f4fd;          /* æµ…è“ï¼ˆé«˜äº®åŒºåŸŸï¼‰ */
  --medium-blue: #b3d7f0;         /* ä¸­è“ */
  --dark-blue: #4a90c2;           /* æ·±è“ */
  --background-blue: #f0f8ff;     /* é¡µé¢èƒŒæ™¯ */
  --text-color: #333333;          /* æ–‡å­—é¢œè‰² */
  --bg-color: #ffffff;            /* ç»„ä»¶èƒŒæ™¯ */
  --border-color: #e8f4fd;        /* è¾¹æ¡†é¢œè‰² */
  --placeholder-color: #a8a8a8;   /* å ä½ç¬¦é¢œè‰² */
  
  /* Element Plus å˜é‡è¦†ç›– */
  --el-color-primary: #64a8db;
  --el-bg-color: #ffffff;
  --el-text-color-primary: #303133;
  --el-border-color: #dcdfe6;
  /* ... æ›´å¤šå˜é‡ ... */
}

/* é»‘å¤œæ¨¡å¼ - åœ¨ .dark-mode ç±»ä¸­è¦†ç›–å˜é‡ */
.dark-mode {
  --primary-blue: #5a9bd4;        /* ä¸»è‰²è°ƒï¼ˆç•¥äº®äºæ—¥é—´ï¼‰ */
  --light-blue: #2a4a5e;          /* æ·±è‰²é«˜äº®åŒºåŸŸ */
  --medium-blue: #3d6b8a;         /* æ·±è‰²ä¸­é—´è‰² */
  --dark-blue: #4a90c2;           /* å¼ºè°ƒè‰² */
  --background-blue: #1a1f26;     /* æ·±è‰²é¡µé¢èƒŒæ™¯ */
  --text-color: #e4e7ed;          /* æµ…è‰²æ–‡å­— */
  --bg-color: #1d1e1f;            /* æ·±è‰²ç»„ä»¶èƒŒæ™¯ */
  --border-color: #414243;        /* æ·±è‰²è¾¹æ¡† */
  --placeholder-color: #8a8b8c;   /* æ·±è‰²å ä½ç¬¦ */
  
  /* Element Plus å˜é‡è¦†ç›– */
  --el-color-primary: #5a9bd4;
  --el-bg-color: #141414;
  --el-text-color-primary: #e5eaf3;
  --el-border-color: #414243;
  /* ... æ›´å¤šå˜é‡ ... */
}
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- æ‰€æœ‰é¢œè‰²é›†ä¸­ç®¡ç†ï¼Œä¸€å¤„ä¿®æ”¹å…¨å±€ç”Ÿæ•ˆ
- é€šè¿‡ CSS å˜é‡ç»§æ‰¿æœºåˆ¶ï¼Œå­å…ƒç´ è‡ªåŠ¨åº”ç”¨çˆ¶çº§å˜é‡
- Element Plus ç»„ä»¶é€šè¿‡è¦†ç›–å…¶å†…ç½®å˜é‡ï¼ˆ`--el-*`ï¼‰å®ç°ä¸»é¢˜é€‚é…

#### 2. çŠ¶æ€ç®¡ç†ï¼š`frontend/src/store/index.js`

```js
// Vuex State
state: {
  isDarkMode: false  // å½“å‰æ˜¯å¦ä¸ºé»‘å¤œæ¨¡å¼
}

// Mutationï¼šæ›´æ–°çŠ¶æ€å¹¶åº”ç”¨åˆ° DOM
mutations: {
  SET_DARK_MODE(state, isDark) {
    state.isDarkMode = isDark
    localStorage.setItem('darkMode', isDark.toString())  // æŒä¹…åŒ–
    if (isDark) {
      document.documentElement.classList.add('dark-mode')  // æ·»åŠ ç±»
    } else {
      document.documentElement.classList.remove('dark-mode')  // ç§»é™¤ç±»
    }
  }
}

// Actionï¼šåˆ‡æ¢æ¨¡å¼
actions: {
  toggleDarkMode({ commit, state }) {
    commit('SET_DARK_MODE', !state.isDarkMode)
  }
}

// Getterï¼šè·å–å½“å‰æ¨¡å¼
getters: {
  isDarkMode: state => state.isDarkMode
}
```

**åˆå§‹åŒ–é€»è¾‘**ï¼š
```js
// åº”ç”¨å¯åŠ¨æ—¶ä» localStorage æ¢å¤ç”¨æˆ·åå¥½
const darkMode = localStorage.getItem('darkMode') === 'true'
commit('SET_DARK_MODE', darkMode)
```

#### 3. UI åˆ‡æ¢ç»„ä»¶ï¼š`Layout.vue` å’Œ `AuthNavbar.vue`

**Layout.vueï¼ˆä¸»ç•Œé¢ï¼‰**ï¼š
```vue
<template>
  <div class="theme-switch" @click="toggleDarkMode">
    <div class="theme-switch-track" :class="{ 'is-dark': isDarkMode }">
      <div class="theme-switch-thumb" :class="{ 'is-dark': isDarkMode }">
        <el-icon v-if="isDarkMode" class="theme-icon">
          <Moon />  <!-- é»‘å¤œæ¨¡å¼æ˜¾ç¤ºæœˆäº®å›¾æ ‡ -->
        </el-icon>
        <el-icon v-else class="theme-icon">
          <Sunny />  <!-- æ—¥é—´æ¨¡å¼æ˜¾ç¤ºå¤ªé˜³å›¾æ ‡ -->
        </el-icon>
      </div>
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useStore } from 'vuex'

const store = useStore()
const isDarkMode = computed(() => store.getters.isDarkMode)

const toggleDarkMode = () => {
  store.dispatch('toggleDarkMode')
}
</script>
```

**åˆ‡æ¢å¼€å…³æ ·å¼**ï¼ˆæ¨¡æ‹Ÿå¼€å…³æ•ˆæœï¼‰ï¼š
```css
.theme-switch {
  width: 60px;
  height: 32px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.theme-switch-track {
  width: 100%;
  height: 100%;
  background: var(--light-blue);
  border-radius: 16px;
  position: relative;
  transition: background 0.3s ease;
}

.theme-switch-track.is-dark {
  background: var(--dark-blue);  /* é»‘å¤œæ¨¡å¼èƒŒæ™¯è‰² */
}

.theme-switch-thumb {
  width: 28px;
  height: 28px;
  background: white;
  border-radius: 50%;
  position: absolute;
  top: 2px;
  left: 2px;
  transition: transform 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-switch-thumb.is-dark {
  transform: translateX(28px);  /* æ»‘åŠ¨åˆ°å³ä¾§ */
}

.theme-icon {
  font-size: 16px;
  color: var(--dark-blue);
}
```

### å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·ç‚¹å‡»åˆ‡æ¢æŒ‰é’®                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è§¦å‘ toggleDarkMode() æ–¹æ³•                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - è°ƒç”¨ store.dispatch('toggleDarkMode')                        â”‚
â”‚ - Vuex Action æ‰§è¡ŒçŠ¶æ€åˆ‡æ¢é€»è¾‘                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Mutation æ›´æ–°çŠ¶æ€                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SET_DARK_MODE(state, !state.isDarkMode)                        â”‚
â”‚ - æ›´æ–° state.isDarkMode                                         â”‚
â”‚ - ä¿å­˜åˆ° localStorage.setItem('darkMode', isDark.toString())   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. DOM æ“ä½œ                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ if (isDark) {                                                   â”‚
â”‚   document.documentElement.classList.add('dark-mode')           â”‚
â”‚ } else {                                                        â”‚
â”‚   document.documentElement.classList.remove('dark-mode')        â”‚
â”‚ }                                                               â”‚
â”‚                                                                 â”‚
â”‚ è¿™ä¼šåœ¨ <html> æ ‡ç­¾ä¸Šæ·»åŠ /ç§»é™¤ 'dark-mode' ç±»                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. CSS å˜é‡ç”Ÿæ•ˆ                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å› ä¸º <html> æ ‡ç­¾æœ‰äº† .dark-mode ç±»ï¼Œæµè§ˆå™¨ä¼šåº”ç”¨ï¼š               â”‚
â”‚                                                                 â”‚
â”‚ .dark-mode {                                                    â”‚
â”‚   --text-color: #e4e7ed;      â† è¦†ç›– :root ä¸­çš„å˜é‡             â”‚
â”‚   --bg-color: #1d1e1f;                                          â”‚
â”‚   ...                                                           â”‚
â”‚ }                                                               â”‚
â”‚                                                                 â”‚
â”‚ æ‰€æœ‰ä½¿ç”¨ var(--text-color) çš„å…ƒç´ ç«‹å³æ›´æ–°é¢œè‰²                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç•Œé¢é‡æ–°æ¸²æŸ“                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Vue å“åº”å¼æ›´æ–° isDarkMode è®¡ç®—å±æ€§                             â”‚
â”‚ - åˆ‡æ¢æŒ‰é’®å›¾æ ‡ä»å¤ªé˜³å˜ä¸ºæœˆäº®ï¼ˆæˆ–åä¹‹ï¼‰                            â”‚
â”‚ - æ»‘å—ä½ç½®ç§»åŠ¨ï¼ˆCSS transformï¼‰                                  â”‚
â”‚ - æ‰€æœ‰ç»„ä»¶é¢œè‰²ç¬é—´åˆ‡æ¢                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æŠ€æœ¯ç‚¹

#### 1. CSS å˜é‡çš„ç»§æ‰¿æœºåˆ¶

```css
/* å®šä¹‰åœ¨ :root æˆ– .dark-mode */
.dark-mode {
  --text-color: #e4e7ed;
}

/* ä»»ä½•å­å…ƒç´ éƒ½å¯ä»¥ä½¿ç”¨ */
.message-text {
  color: var(--text-color);  /* è‡ªåŠ¨è·å–çˆ¶çº§å˜é‡å€¼ */
}
```

å½“ `<html>` æ ‡ç­¾æœ‰ `.dark-mode` ç±»æ—¶ï¼Œ`--text-color` çš„å€¼ä» `#333333` å˜ä¸º `#e4e7ed`ï¼Œæ‰€æœ‰ä½¿ç”¨è¯¥å˜é‡çš„å…ƒç´ è‡ªåŠ¨æ›´æ–°ã€‚

#### 2. Element Plus ç»„ä»¶é€‚é…

Element Plus å†…éƒ¨ä½¿ç”¨äº†å¤§é‡ CSS å˜é‡ï¼ˆå¦‚ `--el-color-primary`ï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡è¦†ç›–è¿™äº›å˜é‡æ¥é€‚é…é»‘å¤œæ¨¡å¼ï¼š

```css
.dark-mode {
  /* è¦†ç›– Element Plus ä¸»é¢˜è‰² */
  --el-color-primary: #5a9bd4;
  --el-bg-color: #141414;
  --el-text-color-primary: #e5eaf3;
  
  /* è¦†ç›–çŠ¶æ€é¢œè‰² */
  --el-color-success: #67c23a;
  --el-color-warning: #e6a23c;
  --el-color-danger: #f56c6c;
}

/* å¯¹ç‰¹å®šç»„ä»¶è¿›è¡Œæ·±åº¦æ ·å¼è¦†ç›– */
.el-dialog {
  background-color: var(--el-bg-color-overlay) !important;
}

.el-table {
  --el-table-bg-color: var(--el-bg-color-overlay);
  --el-table-text-color: var(--el-text-color-primary);
}
```

#### 3. æŒä¹…åŒ–å­˜å‚¨

```js
// ä¿å­˜ç”¨æˆ·åå¥½
localStorage.setItem('darkMode', 'true')

// åº”ç”¨å¯åŠ¨æ—¶æ¢å¤
const darkMode = localStorage.getItem('darkMode') === 'true'
if (darkMode) {
  document.documentElement.classList.add('dark-mode')
}
```

è¿™æ ·ç”¨æˆ·å…³é—­æµè§ˆå™¨åå†æ‰“å¼€ï¼Œä»ä¼šä¿æŒä¸Šæ¬¡é€‰æ‹©çš„ä¸»é¢˜æ¨¡å¼ã€‚

#### 4. åŠ¨ç”»è¿‡æ¸¡ï¼ˆå·²ç¦ç”¨ï¼‰

æœ¬é¡¹ç›®ä¸ºäº†å³æ—¶å“åº”ï¼Œç¦ç”¨äº†æ‰€æœ‰ CSS è¿‡æ¸¡åŠ¨ç”»ï¼ˆ`transition: none !important`ï¼‰ï¼Œä½†ä¿ç•™äº†åˆ‡æ¢æŒ‰é’®çš„åŠ¨ç”»æ•ˆæœã€‚å¦‚æœéœ€è¦å¯ç”¨å¹³æ»‘è¿‡æ¸¡ï¼Œå¯ä»¥ç§»é™¤ `main.css` ä¸­çš„ä»¥ä¸‹ä»£ç ï¼š

```css
/* å½“å‰é…ç½®ï¼šç¦ç”¨æ‰€æœ‰è¿‡æ¸¡ */
*, *::before, *::after {
  transition: none !important;  /* â† åˆ é™¤æ­¤è¡Œå³å¯å¯ç”¨è¿‡æ¸¡ */
  animation: none !important;
}
```

### è‡ªå®šä¹‰é¢œè‰²æŒ‡å—

#### ä¿®æ”¹ä¸»é¢˜è‰²

ç¼–è¾‘ `frontend/src/assets/styles/main.css`ï¼š

```css
.dark-mode {
  /* GitHub é£æ ¼æ·±è‰²ä¸»é¢˜ */
  --primary-blue: #58a6ff;
  --background-blue: #0d1117;
  --bg-color: #161b22;
  --border-color: #30363d;
  --text-color: #c9d1d9;
}
```

#### æ·»åŠ æ–°çš„ä¸»é¢˜å˜é‡

1. åœ¨ `:root` å’Œ `.dark-mode` ä¸­åŒæ—¶å®šä¹‰å˜é‡
2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `var(--your-variable)`

```css
:root {
  --custom-highlight: #ffeb3b;  /* æ—¥é—´é«˜äº®è‰² */
}

.dark-mode {
  --custom-highlight: #fdd835;  /* é»‘å¤œé«˜äº®è‰² */
}
```

```vue
<style scoped>
.highlight-text {
  background-color: var(--custom-highlight);
}
</style>
```

### æµè§ˆå™¨å…¼å®¹æ€§

- **CSS å˜é‡**ï¼šChrome 49+, Firefox 31+, Safari 9.1+, Edge 15+
- **`classList` API**ï¼šæ‰€æœ‰ç°ä»£æµè§ˆå™¨
- **`localStorage`**ï¼šæ‰€æœ‰ç°ä»£æµè§ˆå™¨

å¦‚éœ€å…¼å®¹ IE11ï¼Œéœ€è¦ä½¿ç”¨ PostCSS æ’ä»¶è½¬æ¢ CSS å˜é‡ï¼Œæˆ–å›é€€åˆ° Sass å˜é‡ + ç¼–è¯‘æ—¶ä¸»é¢˜åˆ‡æ¢æ–¹æ¡ˆã€‚

---

## Vuex çŠ¶æ€ç®¡ç†ä¸ Mutation

### Vuex åœ¨é¡¹ç›®ä¸­çš„ä½ç½®

Vuex æ˜¯ Vue å®˜æ–¹çš„**é›†ä¸­å¼çŠ¶æ€ç®¡ç†åº“**ï¼Œåœ¨æœ¬é¡¹ç›®ä¸­çš„ç»„ç»‡ç»“æ„å¦‚ä¸‹ï¼š

```
frontend/src/
â”œâ”€â”€ store/                      # Vuex çŠ¶æ€ç®¡ç†ç›®å½•ï¼ˆç‰¹æ®Šçº¦å®šç›®å½•ï¼‰
â”‚   â”œâ”€â”€ index.js               # ä¸» store æ–‡ä»¶ï¼Œå®šä¹‰å…¨å±€çŠ¶æ€å’Œ mutations
â”‚   â””â”€â”€ modules/               # Vuex æ¨¡å—ï¼ˆæŒ‰åŠŸèƒ½æ‹†åˆ†ï¼‰
â”‚       â””â”€â”€ model.js           # æ¨¡å‹é…ç½®ç›¸å…³çŠ¶æ€
â”œâ”€â”€ main.js                    # åº”ç”¨å…¥å£ï¼Œæ³¨å†Œ store
â””â”€â”€ views/                     # ç»„ä»¶ä¸­é€šè¿‡ useStore() ä½¿ç”¨
    â””â”€â”€ *.vue
```

**å…³é”®æ–‡ä»¶**ï¼š
- **`frontend/src/store/index.js`**ï¼šä¸» storeï¼Œå®šä¹‰å…¨å±€çŠ¶æ€ï¼ˆç”¨æˆ·ã€ç™»å½•æ€ã€æš—è‰²æ¨¡å¼ç­‰ï¼‰
- **`frontend/src/main.js`**ï¼šé€šè¿‡ `app.use(store)` å°† Vuex æ³¨å†Œåˆ° Vue åº”ç”¨

### Vue åº”ç”¨å…¥å£ï¼š`main.js` è¯¦è§£

`frontend/src/main.js` æ˜¯æ•´ä¸ª Vue åº”ç”¨çš„**å…¥å£æ–‡ä»¶**ï¼Œè´Ÿè´£åˆ›å»ºåº”ç”¨å®ä¾‹ã€æ³¨å†Œæ’ä»¶å¹¶æŒ‚è½½åˆ° DOMã€‚

#### å®Œæ•´ä»£ç è§£æ

```js
// ç¬¬1è¡Œï¼šä» Vue å¯¼å…¥ createApp æ–¹æ³•
import { createApp } from 'vue'

// ç¬¬2è¡Œï¼šå¯¼å…¥æ ¹ç»„ä»¶ App.vue
import App from './App.vue'

// ç¬¬3-4è¡Œï¼šå¯¼å…¥è·¯ç”±å’Œ Vuex store
import router from './router'      // è·¯ç”±é…ç½®
import store from './store'        // â† Vuex store ä» ./store/index.js å¯¼å…¥

// ç¬¬5-8è¡Œï¼šå¯¼å…¥ Element Plus UI åº“å’Œå…¨å±€æ ·å¼
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
import './assets/styles/main.css'

// ç¬¬11è¡Œï¼šåˆ›å»º Vue åº”ç”¨å®ä¾‹
const app = createApp(App)  // â† app å°±æ˜¯ä½ çš„æ•´ä¸ª Vue åº”ç”¨å®ä¾‹

// ç¬¬14-16è¡Œï¼šæ³¨å†Œæ‰€æœ‰ Element Plus å›¾æ ‡ä¸ºå…¨å±€ç»„ä»¶
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)  // å…¨å±€æ³¨å†Œå›¾æ ‡
}

// ç¬¬18-20è¡Œï¼šæ³¨å†Œæ’ä»¶ï¼ˆè¿™é‡Œå°±æ˜¯æ³¨å†Œçš„åœ°æ–¹ï¼ï¼‰
app.use(store)        // â† æ³¨å†Œ Vuex storeï¼ˆç¬¬18è¡Œï¼‰
app.use(router)       // æ³¨å†Œ Vue Router
app.use(ElementPlus)  // æ³¨å†Œ Element Plus UI åº“

// ç¬¬22-24è¡Œï¼šåˆå§‹åŒ–å¹¶æŒ‚è½½åº”ç”¨
store.dispatch('loadUserFromStorage').then(() => {
  app.mount('#app')  // å°† Vue åº”ç”¨æŒ‚è½½åˆ° HTML ä¸­çš„ <div id="app">
})
```

#### `app` æ˜¯ä»€ä¹ˆï¼Ÿ

`app` æ˜¯ **Vue åº”ç”¨å®ä¾‹**ï¼Œç”± `createApp(App)` åˆ›å»ºï¼š

```js
import { createApp } from 'vue'  // ä» Vue å¯¼å…¥åˆ›å»ºåº”ç”¨çš„æ–¹æ³•
import App from './App.vue'      // å¯¼å…¥æ ¹ç»„ä»¶

const app = createApp(App)       // åˆ›å»º Vue åº”ç”¨å®ä¾‹
```

**`app` çš„æ ¸å¿ƒä½œç”¨**ï¼š
- ğŸ“¦ æ•´ä¸ª Vue åº”ç”¨çš„å®¹å™¨
- ğŸ”Œ æ³¨å†Œå…¨å±€æ’ä»¶ï¼š`app.use()`
- ğŸ§© æ³¨å†Œå…¨å±€ç»„ä»¶ï¼š`app.component()`
- âš™ï¸ è®¾ç½®å…¨å±€é…ç½®ï¼š`app.config`
- ğŸ¯ æŒ‚è½½åˆ° DOMï¼š`app.mount('#app')`

#### `app.use(store)` åšäº†ä»€ä¹ˆï¼Ÿ

```js
import store from './store'  // å¯¼å…¥ storeï¼ˆå®é™…è·¯å¾„ï¼š./store/index.jsï¼‰

app.use(store)  // æ³¨å†Œ Vuex store åˆ° Vue åº”ç”¨ï¼ˆç¬¬18è¡Œï¼‰
```

**æ‰§è¡Œæ•ˆæœ**ï¼š
1. å°† `store` æ³¨å†Œä¸º Vue æ’ä»¶
2. è®©**æ‰€æœ‰ç»„ä»¶**éƒ½èƒ½é€šè¿‡ `useStore()` è®¿é—® store
3. å®ç°å…¨å±€çŠ¶æ€ç®¡ç†

**ç±»æ¯”ç†è§£**ï¼š
```
app.use(store)  â†’  å®‰è£…ä¸­å¤®æ§åˆ¶ç³»ç»Ÿ
useStore()      â†’  ä»»ä½•æˆ¿é—´ï¼ˆç»„ä»¶ï¼‰éƒ½èƒ½è®¿é—®è¿™ä¸ªç³»ç»Ÿ
```

#### ä¸ºä»€ä¹ˆç»„ä»¶ä¸­èƒ½ç”¨ `useStore()`ï¼Ÿ

```js
// main.jsï¼ˆåº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
app.use(store)  // â† åœ¨è¿™é‡Œå…¨å±€æ³¨å†Œäº†

// ä»»ä½•ç»„ä»¶ä¸­ï¼ˆLayout.vue, ModelChat.vue ç­‰ï¼‰
import { useStore } from 'vuex'
const store = useStore()  // âœ… å¯ä»¥è®¿é—®ï¼Œå› ä¸ºå·²ç»å…¨å±€æ³¨å†Œäº†
```

**å¦‚æœæ²¡æœ‰ `app.use(store)`**ï¼š
```js
const store = useStore()  // âŒ æŠ¥é”™ï¼šCannot access store
```

#### åº”ç”¨å¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ frontend/src/main.jsï¼ˆåº”ç”¨å…¥å£ï¼‰                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯¼å…¥ä¾èµ–                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ import { createApp } from 'vue'                                 â”‚
â”‚ import App from './App.vue'          â† æ ¹ç»„ä»¶                    â”‚
â”‚ import router from './router'        â† è·¯ç”±é…ç½®                  â”‚
â”‚ import store from './store'          â† Vuex store              â”‚
â”‚ import ElementPlus from 'element-plus' â† UI åº“                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆ›å»º Vue åº”ç”¨å®ä¾‹                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ const app = createApp(App)                                      â”‚
â”‚                                                                 â”‚
â”‚ app å°±æ˜¯ä½ çš„æ•´ä¸ª Vue åº”ç”¨                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ³¨å†Œæ’ä»¶å’Œç»„ä»¶                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ app.use(store)        â† æ³¨å†Œ Vuexï¼ˆç¬¬18è¡Œï¼‰                      â”‚
â”‚ app.use(router)       â† æ³¨å†Œè·¯ç”±                                 â”‚
â”‚ app.use(ElementPlus)  â† æ³¨å†Œ UI åº“                               â”‚
â”‚                                                                 â”‚
â”‚ æ³¨å†Œåï¼Œæ‰€æœ‰ç»„ä»¶éƒ½èƒ½ä½¿ç”¨è¿™äº›åŠŸèƒ½                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. åˆå§‹åŒ–å’ŒæŒ‚è½½                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ store.dispatch('loadUserFromStorage')  â† ä» localStorage æ¢å¤çŠ¶æ€â”‚
â”‚   .then(() => {                                                 â”‚
â”‚     app.mount('#app')  â† æŒ‚è½½åˆ° HTML çš„ <div id="app">          â”‚
â”‚   })                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. åº”ç”¨è¿è¡Œä¸­                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‰€æœ‰ç»„ä»¶ç°åœ¨éƒ½å¯ä»¥ï¼š                                              â”‚
â”‚ - ä½¿ç”¨ useStore() è®¿é—® Vuex                                      â”‚
â”‚ - ä½¿ç”¨ useRouter() è®¿é—®è·¯ç”±                                      â”‚
â”‚ - ä½¿ç”¨ Element Plus ç»„ä»¶ï¼ˆå¦‚ <el-button>ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### HTML æŒ‚è½½ç‚¹

`app.mount('#app')` ä¼šå°† Vue åº”ç”¨æŒ‚è½½åˆ° HTML ä¸­çš„æŒ‡å®šå…ƒç´ ï¼š

```html
<!-- frontend/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <title>ä¼ä¸šæ¨¡å‹è®­ç»ƒå¹³å°</title>
  </head>
  <body>
    <div id="app"></div>  â† Vue åº”ç”¨æŒ‚è½½åˆ°è¿™é‡Œ
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
```

æŒ‚è½½åï¼Œ`<div id="app">` å†…çš„å†…å®¹ä¼šè¢« Vue åº”ç”¨çš„æ ¹ç»„ä»¶ï¼ˆ`App.vue`ï¼‰æ›¿æ¢ã€‚

#### æ’ä»¶æ³¨å†Œå¯¹æ¯”

```js
// main.js - é€šè¿‡ app.use() æ³¨å†Œæ’ä»¶
app.use(store)        // æ³¨å†Œ Vuex â†’ ç»„ä»¶ä¸­ç”¨ useStore()
app.use(router)       // æ³¨å†Œè·¯ç”± â†’ ç»„ä»¶ä¸­ç”¨ useRouter()
app.use(ElementPlus)  // æ³¨å†Œ UI åº“ â†’ ç»„ä»¶ä¸­ç”¨ <el-button> ç­‰

// éƒ½æ˜¯é€šè¿‡ app.use() æ³¨å†Œï¼Œè®©æ‰€æœ‰ç»„ä»¶éƒ½èƒ½è®¿é—®
```

#### å…³é”®æ¦‚å¿µæ€»ç»“

| é—®é¢˜ | ç­”æ¡ˆ |
|------|------|
| **Vuex é»˜è®¤åœ¨å“ªï¼Ÿ** | `frontend/src/store/index.js` |
| **åœ¨å“ªæ³¨å†Œçš„ï¼Ÿ** | `frontend/src/main.js` ç¬¬18è¡Œ `app.use(store)` |
| **app æ˜¯ä»€ä¹ˆï¼Ÿ** | Vue åº”ç”¨å®ä¾‹ï¼Œç”± `createApp(App)` åˆ›å»º |
| **ä¸ºä»€ä¹ˆç»„ä»¶èƒ½ç”¨ `useStore()`ï¼Ÿ** | å› ä¸º `app.use(store)` å…¨å±€æ³¨å†Œäº† |
| **æ‰§è¡Œé¡ºåº** | å¯¼å…¥ä¾èµ– â†’ åˆ›å»º app â†’ æ³¨å†Œæ’ä»¶ â†’ åˆå§‹åŒ–çŠ¶æ€ â†’ æŒ‚è½½åˆ° DOM â†’ åº”ç”¨è¿è¡Œ |
| **å…¥å£æ–‡ä»¶** | `frontend/src/main.js` |
| **æŒ‚è½½ç‚¹** | HTML ä¸­çš„ `<div id="app">` |

### Vuex çš„ä½¿ç”¨æ–¹å¼

#### 1. åœ¨ main.js ä¸­æ³¨å†Œï¼ˆå…¨å±€é…ç½®ï¼‰

```js
// frontend/src/main.js
import { createApp } from 'vue'
import App from './App.vue'
import store from './store'  // å¯¼å…¥ Vuex store

const app = createApp(App)
app.use(store)  // æ³¨å†Œåˆ° Vue åº”ç”¨ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½å¯è®¿é—®
app.mount('#app')
```

#### 2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼ˆé€šè¿‡ Composition APIï¼‰

```vue
<script setup>
import { computed } from 'vue'
import { useStore } from 'vuex'  // å¯¼å…¥ useStore æ–¹æ³•

const store = useStore()  // è·å– store å®ä¾‹

// è¯»å–çŠ¶æ€ï¼ˆé€šè¿‡ getterï¼‰
const isDarkMode = computed(() => store.getters.isDarkMode)
const userName = computed(() => store.getters.userName)

// è§¦å‘ action
const toggleDarkMode = () => {
  store.dispatch('toggleDarkMode')  // è°ƒç”¨ action
}

// ç›´æ¥ commit mutationï¼ˆä¸æ¨èï¼Œåº”é€šè¿‡ actionï¼‰
const directCommit = () => {
  store.commit('SET_DARK_MODE', true)  // ç›´æ¥æäº¤ mutation
}
</script>
```

### Vuex Store çš„å®Œæ•´ç»“æ„ï¼ˆå››å¤§æ ¸å¿ƒæ¦‚å¿µï¼‰

é¦–å…ˆè¦ç†è§£ï¼š**State, Mutations, Actions, Getters æ˜¯å¹³çº§çš„**ï¼Œä¸æ˜¯åµŒå¥—å…³ç³»ï¼

```js
// frontend/src/store/index.js
import { createStore } from 'vuex'

export default createStore({
  // 1. State - å­˜å‚¨æ•°æ®ï¼ˆæ•°æ®ä»“åº“ï¼‰
  state: {
    isDarkMode: false,
    user: null
  },
  
  // 2. Mutations - ä¿®æ”¹ stateï¼ˆä¿®æ”¹å™¨ï¼ŒåŒæ­¥ï¼‰
  mutations: {
    SET_DARK_MODE(state, isDark) { ... }
  },
  
  // 3. Actions - ä¸šåŠ¡é€»è¾‘ï¼ˆå¯å¼‚æ­¥ï¼‰
  actions: {
    toggleDarkMode({ commit }) { ... }
  },
  
  // 4. Getters - è®¡ç®—å±æ€§ï¼ˆæ´¾ç”Ÿæ•°æ®ï¼‰
  getters: {
    isDarkMode: state => state.isDarkMode
  }
})
```

**æ ¸å¿ƒå…³ç³»å›¾**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vuex Storeï¼ˆçŠ¶æ€ç®¡ç†ä»“åº“ï¼‰                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Stateï¼ˆæ•°æ®ä»“åº“ï¼‰                                           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ { isDarkMode: false, user: null }                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â†‘                          â†‘                       â”‚
â”‚              â”‚ ä¿®æ”¹                     â”‚ è¯»å–                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Mutationsï¼ˆä¿®æ”¹å™¨ï¼‰   â”‚    â”‚ Gettersï¼ˆè®¡ç®—å±æ€§ï¼‰  â”‚         â”‚
â”‚  â”‚ - åŒæ­¥                â”‚    â”‚ - æœ‰ç¼“å­˜             â”‚         â”‚
â”‚  â”‚ - å”¯ä¸€ä¿®æ”¹å…¥å£        â”‚    â”‚ - æ´¾ç”Ÿæ•°æ®           â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚              â†‘ commit                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Actionsï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰                                       â”‚ â”‚
â”‚  â”‚ - å¯å¼‚æ­¥                                                   â”‚ â”‚
â”‚  â”‚ - å¯åŒ…å«å¤æ‚é€»è¾‘                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚              â†‘ dispatch                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç»„ä»¶ï¼ˆComponentï¼‰    â”‚
    â”‚ useStore()          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1. Stateï¼ˆçŠ¶æ€/æ•°æ®ä»“åº“ï¼‰

```js
state: {
  isDarkMode: false,  // æ•°æ®å­˜å‚¨åœ¨è¿™é‡Œ
  user: null,
  chatSessions: []
}
```

**ç‰¹ç‚¹**ï¼š
- ğŸ“¦ å­˜å‚¨åº”ç”¨çš„æ‰€æœ‰æ•°æ®
- ğŸ”’ åªèƒ½é€šè¿‡ `mutations` ä¿®æ”¹
- ğŸ” å¯ä»¥é€šè¿‡ `getters` è¯»å–
- ğŸ’¾ ç±»ä¼¼äºç»„ä»¶çš„ `data()`

**è®¿é—®æ–¹å¼**ï¼š
```js
store.state.isDarkMode           // ç›´æ¥è®¿é—®
store.getters.isDarkMode         // é€šè¿‡ getterï¼ˆæ¨èï¼‰
```

---

### 2. Mutationsï¼ˆçŠ¶æ€ä¿®æ”¹å™¨ï¼‰

**Mutation** æ˜¯ Vuex ä¸­**å”¯ä¸€å…è®¸ä¿®æ”¹ stateï¼ˆçŠ¶æ€ï¼‰çš„æ–¹æ³•**ï¼Œè¿™æ˜¯ Vuex çš„å¼ºåˆ¶è§„åˆ™ã€‚

#### æ ¸å¿ƒç‰¹ç‚¹

1. **åŒæ­¥æ“ä½œ**ï¼šMutation å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°ï¼ˆä¸èƒ½ç”¨ `async/await`ï¼‰
2. **å”¯ä¸€ä¿®æ”¹å…¥å£**ï¼šstate åªèƒ½é€šè¿‡ mutation ä¿®æ”¹
3. **å¯è¿½è¸ª**ï¼šæ¯æ¬¡ mutation éƒ½ä¼šè¢« Vuex DevTools è®°å½•
4. **å‘½åçº¦å®š**ï¼šé€šå¸¸ç”¨ `SCREAMING_SNAKE_CASE`ï¼ˆå…¨å¤§å†™ä¸‹åˆ’çº¿ï¼‰

#### ä¸ºä»€ä¹ˆå¿…é¡»é€šè¿‡ Mutationï¼Ÿ

```js
// âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥ä¿®æ”¹ state
store.state.isDarkMode = true  
// é—®é¢˜ï¼š
// - æ— æ³•è¿½è¸ªæ˜¯è°ä¿®æ”¹çš„
// - æ— æ³•è®°å½•ä¿®æ”¹å†å²
// - DevTools æ— æ³•æ•è·

// âœ… æ­£ç¡®åšæ³•ï¼šé€šè¿‡ mutation
store.commit('SET_DARK_MODE', true)
// ä¼˜åŠ¿ï¼š
// - æ‰€æœ‰ä¿®æ”¹éƒ½è¢«è®°å½•
// - å¯ä»¥åœ¨ DevTools ä¸­çœ‹åˆ°æ—¶é—´çº¿
// - æ”¯æŒæ—¶é—´æ—…è¡Œè°ƒè¯•
```

#### é¡¹ç›®ä¸­çš„å®é™…ä»£ç 

```js
// frontend/src/store/index.js
export default createStore({
  state: {
    isDarkMode: false,     // çŠ¶æ€ï¼šæ˜¯å¦ä¸ºé»‘å¤œæ¨¡å¼
    user: null,            // çŠ¶æ€ï¼šå½“å‰ç”¨æˆ·
    isLoggedIn: false      // çŠ¶æ€ï¼šæ˜¯å¦å·²ç™»å½•
  },
  
  mutations: {
    // Mutationï¼šä¿®æ”¹é»‘å¤œæ¨¡å¼çŠ¶æ€
    SET_DARK_MODE(state, isDark) {
      // å‚æ•°1ï¼šstateï¼ˆè‡ªåŠ¨ä¼ å…¥ï¼‰
      // å‚æ•°2ï¼špayloadï¼ˆè°ƒç”¨æ—¶ä¼ å…¥çš„æ•°æ®ï¼‰
      
      state.isDarkMode = isDark  // ä¿®æ”¹çŠ¶æ€
      
      // å‰¯ä½œç”¨ï¼šæŒä¹…åŒ–åˆ° localStorage
      localStorage.setItem('darkMode', isDark.toString())
      
      // å‰¯ä½œç”¨ï¼šåº”ç”¨åˆ° DOM
      if (isDark) {
        document.documentElement.classList.add('dark-mode')
      } else {
        document.documentElement.classList.remove('dark-mode')
      }
    },
    
    // Mutationï¼šè®¾ç½®ç”¨æˆ·ä¿¡æ¯
    SET_USER(state, user) {
      state.user = user
      state.isLoggedIn = !!user
    },
    
    // Mutationï¼šç™»å‡º
    LOGOUT(state) {
      state.user = null
      state.isLoggedIn = false
      state.chatSessions = []
      state.currentSession = null
    }
  },
  
  actions: {
    // Actionï¼šåˆ‡æ¢é»‘å¤œæ¨¡å¼ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
    toggleDarkMode({ commit, state }) {
      commit('SET_DARK_MODE', !state.isDarkMode)  // è°ƒç”¨ mutation
    },
    
    // Actionï¼šç™»å½•ï¼ˆå¯åŒ…å«å¼‚æ­¥æ“ä½œï¼‰
    login({ commit }, user) {
      commit('SET_USER', user)
      localStorage.setItem('user', JSON.stringify(user))
    },
    
    // Actionï¼šç™»å‡ºï¼ˆåŒ…å«å¼‚æ­¥ API è°ƒç”¨ï¼‰
    async logout({ commit }) {
      try {
        const { authAPI } = await import('../utils/api')
        await authAPI.logout()  // å¼‚æ­¥æ“ä½œ
      } catch (error) {
        console.error('ç™»å‡ºå¤±è´¥:', error)
      } finally {
        commit('LOGOUT')  // æäº¤ mutation
        localStorage.removeItem('user')
        localStorage.removeItem('token')
      }
    }
  },
  
  getters: {
    // Getterï¼šè®¡ç®—å±æ€§ï¼Œä» state æ´¾ç”Ÿæ•°æ®
    isDarkMode: state => state.isDarkMode,
    isAdmin: state => state.user && state.user.is_admin,
    userName: state => state.user ? state.user.nickname : ''
  }
})
```

### Vuex æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»„ä»¶ï¼ˆComponentï¼‰                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <script setup>                                                  â”‚
â”‚   const store = useStore()                                      â”‚
â”‚                                                                 â”‚
â”‚   // 1. è¯»å–çŠ¶æ€ï¼ˆé€šè¿‡ getterï¼‰                                  â”‚
â”‚   const isDarkMode = computed(() => store.getters.isDarkMode)  â”‚
â”‚                                                                 â”‚
â”‚   // 2. è§¦å‘æ“ä½œï¼ˆé€šè¿‡ dispatch actionï¼‰                         â”‚
â”‚   const toggleMode = () => {                                    â”‚
â”‚     store.dispatch('toggleDarkMode')  â† è°ƒç”¨ action             â”‚
â”‚   }                                                             â”‚
â”‚ </script>                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ dispatch
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Actionsï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ toggleDarkMode({ commit, state }) {                             â”‚
â”‚   // å¯ä»¥åŒ…å«å¼‚æ­¥æ“ä½œã€ä¸šåŠ¡é€»è¾‘                                   â”‚
â”‚   await someAsyncOperation()                                    â”‚
â”‚                                                                 â”‚
â”‚   // é€šè¿‡ commit è°ƒç”¨ mutation                                   â”‚
â”‚   commit('SET_DARK_MODE', !state.isDarkMode)  â† commit          â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ commit
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mutationsï¼ˆçŠ¶æ€ä¿®æ”¹å±‚ï¼‰                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SET_DARK_MODE(state, isDark) {                                  â”‚
â”‚   state.isDarkMode = isDark  â† å”¯ä¸€ä¿®æ”¹ state çš„åœ°æ–¹             â”‚
â”‚   localStorage.setItem('darkMode', isDark.toString())           â”‚
â”‚   document.documentElement.classList.toggle('dark-mode')        â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ çŠ¶æ€æ”¹å˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stateï¼ˆçŠ¶æ€ï¼‰                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                               â”‚
â”‚   isDarkMode: true  â† çŠ¶æ€å·²æ›´æ–°                                 â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ å“åº”å¼æ›´æ–°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»„ä»¶è‡ªåŠ¨é‡æ–°æ¸²æŸ“                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ computed å±æ€§è‡ªåŠ¨æ›´æ–° â†’ è§†å›¾æ›´æ–° â†’ ç”¨æˆ·çœ‹åˆ°æ–°ç•Œé¢                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Actionsï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰

```js
actions: {
  // Action æ˜¯ä¸€ä¸ªå‡½æ•°
  toggleDarkMode({ commit, state }) {
    // å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ï¼š
    // - commit: ç”¨æ¥è°ƒç”¨ mutation
    // - state: å½“å‰çš„ state
    // - dispatch: ç”¨æ¥è°ƒç”¨å…¶ä»– action
    
    // å¯ä»¥åŒ…å«å¼‚æ­¥æ“ä½œ
    await someAsyncOperation()
    
    // æœ€ç»ˆé€šè¿‡ commit è°ƒç”¨ mutation
    commit('SET_DARK_MODE', !state.isDarkMode)
  }
}
```

**Action çš„ç‰¹ç‚¹**ï¼š
- âœ… å¯ä»¥æ˜¯**å¼‚æ­¥**çš„ï¼ˆæ”¯æŒ `async/await`ï¼‰
- âœ… å¯ä»¥åŒ…å«**å¤æ‚ä¸šåŠ¡é€»è¾‘**
- âœ… é€šè¿‡ `commit` è°ƒç”¨ mutation
- âœ… å¯ä»¥è°ƒç”¨å¤šä¸ª mutation
- âœ… è°ƒç”¨æ–¹å¼ï¼š`store.dispatch('actionName', payload)`

**ä¸ºä»€ä¹ˆéœ€è¦ Actionï¼Ÿ**

```js
// åœºæ™¯ï¼šç™»å½•éœ€è¦è°ƒç”¨ APIï¼ˆå¼‚æ­¥æ“ä½œï¼‰
actions: {
  async login({ commit }, credentials) {
    try {
      // âœ… å¼‚æ­¥æ“ä½œæ”¾åœ¨ action ä¸­
      const response = await api.post('/login', credentials)
      
      // âœ… ç„¶åè°ƒç”¨å¤šä¸ª mutation ä¿®æ”¹ state
      commit('SET_USER', response.data.user)
      commit('SET_TOKEN', response.data.token)
      commit('SET_LOGIN_STATUS', true)
      
      return response.data
    } catch (error) {
      commit('SET_ERROR', error.message)
      throw error
    }
  }
}

// âŒ å¦‚æœæ”¾åœ¨ mutation ä¸­ä¼šæŠ¥é”™
mutations: {
  async SET_USER(state, user) {
    // âŒ Mutation ä¸èƒ½æ˜¯å¼‚æ­¥çš„ï¼
    const data = await fetchUser()  // æŠ¥é”™ï¼
    state.user = data
  }
}
```

**è°ƒç”¨æ–¹å¼**ï¼š
```js
// åœ¨ç»„ä»¶ä¸­
store.dispatch('login', { username: 'admin', password: 'admin' })

// æˆ–ä½¿ç”¨ async/await
const result = await store.dispatch('login', credentials)
```

---

### 4. Gettersï¼ˆè®¡ç®—å±æ€§ï¼‰

```js
getters: {
  // Getter æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å€¼å°±æ˜¯ç»“æœ
  isDarkMode: state => state.isDarkMode,
  
  // å¯ä»¥åŸºäº state è®¡ç®—æ–°å€¼
  isAdmin: state => state.user && state.user.is_admin,
  
  // å¯ä»¥ä¾èµ–å…¶ä»– getter
  userName: (state, getters) => {
    return getters.isAdmin ? `ç®¡ç†å‘˜: ${state.user.nickname}` : state.user.nickname
  },
  
  // å¯ä»¥è¿”å›å‡½æ•°ï¼ˆæ”¯æŒä¼ å‚ï¼‰
  getSessionById: state => id => {
    return state.chatSessions.find(session => session.id === id)
  }
}
```

**Getter ä¸æ˜¯å†…ç½®çš„ï¼Œæ˜¯ä½ è‡ªå·±å®šä¹‰çš„ï¼**

**Getter çš„ç‰¹ç‚¹**ï¼š
- ğŸ“Š ç±»ä¼¼äº Vue ç»„ä»¶çš„ `computed`
- ğŸ’¾ åŸºäº `state` è®¡ç®—æ´¾ç”Ÿæ•°æ®
- âš¡ æœ‰ç¼“å­˜ï¼Œåªæœ‰ä¾èµ–çš„ `state` å˜åŒ–æ‰é‡æ–°è®¡ç®—
- ğŸ” è°ƒç”¨æ–¹å¼ï¼š`store.getters.isDarkMode`

**ä¸ºä»€ä¹ˆéœ€è¦ Getterï¼Ÿ**

```js
// åœºæ™¯1ï¼šç®€åŒ–è®¿é—®
// âŒ ä¸ç”¨ getterï¼ˆä»£ç å†—é•¿ï¼‰
const isDarkMode = store.state.isDarkMode
const isAdmin = store.state.user && store.state.user.is_admin

// âœ… ç”¨ getterï¼ˆç®€æ´æ¸…æ™°ï¼‰
const isDarkMode = store.getters.isDarkMode
const isAdmin = store.getters.isAdmin

// åœºæ™¯2ï¼šè®¡ç®—æ´¾ç”Ÿæ•°æ®ï¼ˆé¿å…åœ¨ç»„ä»¶ä¸­é‡å¤è®¡ç®—ï¼‰
getters: {
  // è¿‡æ»¤å‡ºå·²å¯ç”¨çš„æ¨¡å‹
  enabledModels: state => {
    return state.modelConfigs.filter(m => m.status === 1)
  },
  
  // ç»Ÿè®¡ä¼šè¯æ•°é‡
  sessionCount: state => state.chatSessions.length,
  
  // åˆ¤æ–­æ˜¯å¦æœ‰æœªè¯»æ¶ˆæ¯
  hasUnread: state => state.messages.some(m => !m.read),
  
  // è·å–æœ€è¿‘10æ¡ä¼šè¯
  recentSessions: state => state.chatSessions.slice(0, 10)
}

// åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨
const enabledModels = computed(() => store.getters.enabledModels)
```

**Getter çš„ç¼“å­˜æœºåˆ¶**ï¼š
```js
// Getter åªåœ¨ä¾èµ–çš„ state å˜åŒ–æ—¶é‡æ–°è®¡ç®—
getters: {
  expensiveComputation: state => {
    console.log('è®¡ç®—ä¸­...')
    return state.items.map(item => item.price * 1.1)
  }
}

// ç¬¬ä¸€æ¬¡è®¿é—®ï¼šæ‰§è¡Œè®¡ç®—ï¼Œè¾“å‡º "è®¡ç®—ä¸­..."
store.getters.expensiveComputation

// ç¬¬äºŒæ¬¡è®¿é—®ï¼šç›´æ¥è¿”å›ç¼“å­˜ï¼Œä¸è¾“å‡º
store.getters.expensiveComputation

// åªæœ‰å½“ state.items å˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—
```

---

### Mutation vs Action å¯¹æ¯”

| ç‰¹æ€§ | Mutation | Action |
|------|----------|--------|
| **ç›®çš„** | ä¿®æ”¹ state | å¤„ç†ä¸šåŠ¡é€»è¾‘ |
| **åŒæ­¥/å¼‚æ­¥** | å¿…é¡»åŒæ­¥ | å¯ä»¥å¼‚æ­¥ |
| **è°ƒç”¨æ–¹å¼** | `commit('MUTATION_NAME', payload)` | `dispatch('actionName', payload)` |
| **èƒ½å¦è°ƒç”¨å…¶ä»–** | ä¸èƒ½ | å¯ä»¥ commit mutation / dispatch action |
| **DevTools è¿½è¸ª** | æ˜¯ | æ˜¯ |
| **å‘½åçº¦å®š** | `UPPER_SNAKE_CASE` | `camelCase` |
| **å…¸å‹ç”¨é€”** | `SET_USER`, `LOGOUT`, `ADD_MESSAGE` | `login`, `toggleDarkMode`, `fetchData` |
| **ä½•æ—¶ä½¿ç”¨** | ç›´æ¥ä¿®æ”¹ state | åŒ…å«å¼‚æ­¥/å¤æ‚é€»è¾‘æ—¶ |

### ä¸ºä»€ä¹ˆéœ€è¦ Mutationï¼Ÿ

#### 1. çŠ¶æ€å¯è¿½è¸ª

```js
// âŒ é”™è¯¯åšæ³•ï¼šç›´æ¥ä¿®æ”¹ state
store.state.isDarkMode = true  // ä¸ä¼šè¢« DevTools è®°å½•ï¼Œæ— æ³•è¿½è¸ª

// âœ… æ­£ç¡®åšæ³•ï¼šé€šè¿‡ mutation
store.commit('SET_DARK_MODE', true)  // è¢« DevTools è®°å½•ï¼Œå¯è¿½è¸ª
```

#### 2. é›†ä¸­ç®¡ç†çŠ¶æ€å˜æ›´

æ‰€æœ‰çŠ¶æ€ä¿®æ”¹éƒ½åœ¨ `mutations` å¯¹è±¡ä¸­ï¼Œä¾¿äºç»´æŠ¤å’Œè°ƒè¯•ã€‚

#### 3. æ—¶é—´æ—…è¡Œè°ƒè¯•

Vuex DevTools å¯ä»¥è®°å½•æ¯æ¬¡ mutationï¼Œæ”¯æŒ"å›æ”¾"çŠ¶æ€å˜åŒ–ï¼š

```
æ—¶é—´çº¿ï¼š
[14:30:21] SET_USER { nickname: 'admin' }
[14:30:25] SET_DARK_MODE true
[14:30:30] ADD_MESSAGE { content: 'ä½ å¥½' }
[14:30:35] LOGOUT
           â†‘
        å¯ä»¥ç‚¹å‡»å›åˆ°è¿™ä¸ªçŠ¶æ€
```

### åœ¨ç»„ä»¶ä¸­çš„å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

```vue
<template>
  <div class="theme-switcher">
    <div @click="toggleDarkMode">
      å½“å‰æ¨¡å¼: {{ isDarkMode ? 'ğŸŒ™ é»‘å¤œ' : 'â˜€ï¸ æ—¥é—´' }}
    </div>
    <div>ç”¨æˆ·: {{ userName }}</div>
    <div>æ˜¯å¦ç®¡ç†å‘˜: {{ isAdmin ? 'æ˜¯' : 'å¦' }}</div>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useStore } from 'vuex'

// 1. è·å– store å®ä¾‹
const store = useStore()

// 2. è¯»å–çŠ¶æ€ï¼ˆé€šè¿‡ getterï¼Œè‡ªåŠ¨å“åº”å¼ï¼‰
const isDarkMode = computed(() => store.getters.isDarkMode)
const userName = computed(() => store.getters.userName)
const isAdmin = computed(() => store.getters.isAdmin)

// 3. è§¦å‘æ“ä½œï¼ˆæ¨èé€šè¿‡ actionï¼‰
const toggleDarkMode = () => {
  store.dispatch('toggleDarkMode')  // âœ… æ¨èï¼šé€šè¿‡ action
}

// ä¸æ¨èï¼šç›´æ¥ commit mutation
const directToggle = () => {
  store.commit('SET_DARK_MODE', !store.state.isDarkMode)  // âŒ ä¸æ¨è
}
</script>
```

### Vuex æ¨¡å—åŒ–ï¼ˆModulesï¼‰

å½“çŠ¶æ€è¿‡å¤šæ—¶ï¼Œå¯ä»¥å°† store æ‹†åˆ†ä¸ºæ¨¡å—ï¼š

```js
// frontend/src/store/modules/model.js
export default {
  namespaced: true,  // å¯ç”¨å‘½åç©ºé—´
  state: {
    modelConfigs: []
  },
  mutations: {
    SET_MODEL_CONFIGS(state, configs) {
      state.modelConfigs = configs
    }
  },
  actions: {
    async fetchModelConfigs({ commit }) {
      const response = await api.get('/model-config/')
      commit('SET_MODEL_CONFIGS', response.data)
    }
  },
  getters: {
    enabledModels: state => state.modelConfigs.filter(m => m.status === 1)
  }
}

// åœ¨ index.js ä¸­å¼•å…¥
import model from './modules/model'

export default createStore({
  modules: {
    model  // æ³¨å†Œæ¨¡å—
  }
})

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ¨¡å—
const configs = computed(() => store.state.model.modelConfigs)
store.dispatch('model/fetchModelConfigs')  // éœ€è¦åŠ æ¨¡å—å‰ç¼€
```

---

### ç”Ÿæ´»åŒ–ç±»æ¯”ï¼šé“¶è¡Œç³»ç»Ÿ

æƒ³è±¡ Vuex æ˜¯ä¸€ä¸ª**é“¶è¡Œç³»ç»Ÿ**ï¼Œå¸®åŠ©ç†è§£å››å¤§æ ¸å¿ƒæ¦‚å¿µï¼š

#### State = ä¿é™©æŸœï¼ˆé‡‘åº“ï¼‰

```js
state: {
  money: 1000  // ä¿é™©æŸœé‡Œçš„é’±
}
```

- ğŸ’° å­˜æ”¾é‡è¦èµ„äº§ï¼ˆæ•°æ®ï¼‰
- ğŸ”’ ä¸èƒ½éšä¾¿ç¢°
- ğŸ‘ï¸ ä»»ä½•äººéƒ½èƒ½æŸ¥çœ‹ä½™é¢

#### Mutations = é“¶è¡ŒæŸœå‘˜

```js
mutations: {
  DEPOSIT(state, amount) {
    state.money += amount  // åªæœ‰æŸœå‘˜èƒ½æ“ä½œä¿é™©æŸœ
  },
  WITHDRAW(state, amount) {
    state.money -= amount
  }
}
```

- ğŸ‘¨â€ğŸ’¼ **å”¯ä¸€**èƒ½ç›´æ¥æ“ä½œä¿é™©æŸœçš„äºº
- ğŸ“‹ å¿…é¡»éµå®ˆè§„å®šï¼ˆåŒæ­¥æ“ä½œï¼‰
- ğŸ“¹ æ‰€æœ‰æ“ä½œéƒ½è¢«ç›‘æ§æ‘„åƒå¤´è®°å½•ï¼ˆDevToolsï¼‰
- ğŸš« ä¸èƒ½åšå¤æ‚å†³ç­–ï¼ˆåªæ‰§è¡ŒæŒ‡ä»¤ï¼‰

#### Actions = é“¶è¡Œä¸šåŠ¡æµç¨‹

```js
actions: {
  async depositWithInterest({ commit }, amount) {
    // å¯ä»¥åŒ…å«å¤æ‚ä¸šåŠ¡æµç¨‹
    console.log('éªŒè¯èº«ä»½...')
    await verifyIdentity()
    
    console.log('è®¡ç®—åˆ©æ¯...')
    const interest = await calculateInterest(amount)
    
    console.log('å®¡æ‰¹é€šè¿‡ï¼Œå­˜å…¥é‡‘åº“...')
    const total = amount + interest
    
    // æœ€ç»ˆé€šè¿‡æŸœå‘˜ï¼ˆmutationï¼‰æ“ä½œä¿é™©æŸœ
    commit('DEPOSIT', total)
  },
  
  async transferMoney({ commit, state }, { to, amount }) {
    // å¤æ‚ä¸šåŠ¡ï¼šè½¬è´¦éœ€è¦å¤šæ­¥æ“ä½œ
    if (state.money < amount) {
      throw new Error('ä½™é¢ä¸è¶³')
    }
    
    await callBankAPI('/transfer', { to, amount })
    commit('WITHDRAW', amount)
    commit('ADD_TRANSACTION', { type: 'transfer', to, amount })
  }
}
```

- ğŸ¦ å¤„ç†å¤æ‚çš„é“¶è¡Œä¸šåŠ¡
- â° å¯ä»¥å¼‚æ­¥ï¼ˆç­‰å¾…å®¡æ‰¹ã€æŸ¥è¯¢ç­‰ï¼‰
- ğŸ¤ å¯ä»¥è°ƒç”¨å¤šä¸ªæŸœå‘˜ï¼ˆcommit å¤šæ¬¡ï¼‰
- ğŸ“ å¯ä»¥è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼ˆAPIï¼‰

#### Getters = é“¶è¡ŒæŸ¥è¯¢çª—å£

```js
getters: {
  currentMoney: state => state.money,
  canBuyHouse: state => state.money > 1000000,
  canBuyCar: state => state.money > 500000,
  wealthLevel: state => {
    if (state.money > 10000000) return 'å¯Œè±ª'
    if (state.money > 1000000) return 'å¯Œè£•'
    if (state.money > 100000) return 'å°åº·'
    return 'æ™®é€š'
  }
}
```

- ğŸ” æä¾›ä¾¿æ·çš„æŸ¥è¯¢æœåŠ¡
- ğŸ“Š å¯ä»¥è®¡ç®—æ´¾ç”Ÿä¿¡æ¯ï¼ˆå¯Œè£•ç¨‹åº¦ï¼‰
- ğŸ’¾ æœ‰ç¼“å­˜ï¼Œä½™é¢ä¸å˜å°±ä¸é‡æ–°è®¡ç®—
- ğŸš« ä¸èƒ½ä¿®æ”¹æ•°æ®ï¼ˆåªæŸ¥è¯¢ä¸åŠç†ä¸šåŠ¡ï¼‰

#### å®Œæ•´åœºæ™¯ç¤ºä¾‹

```js
// å®¢æˆ·ï¼ˆç»„ä»¶ï¼‰æ¥åŠç†ä¸šåŠ¡
const customer = {
  // 1. æŸ¥è¯¢ä½™é¢ï¼ˆé€šè¿‡ getterï¼‰
  checkBalance() {
    console.log('å½“å‰ä½™é¢:', store.getters.currentMoney)
    console.log('è´¢å¯Œç­‰çº§:', store.getters.wealthLevel)
  },
  
  // 2. åŠç†ä¸šåŠ¡ï¼ˆé€šè¿‡ actionï¼‰
  async deposit(amount) {
    // å‘Šè¯‰é“¶è¡Œè¦åŠç†å­˜æ¬¾ä¸šåŠ¡
    await store.dispatch('depositWithInterest', amount)
  },
  
  // 3. ç›´æ¥æ‰¾æŸœå‘˜ï¼ˆä¸æ¨èï¼Œåº”è¯¥èµ°ä¸šåŠ¡æµç¨‹ï¼‰
  directDeposit(amount) {
    // âŒ ä¸æ¨èï¼šè·³è¿‡ä¸šåŠ¡æµç¨‹ç›´æ¥æ‰¾æŸœå‘˜
    store.commit('DEPOSIT', amount)
  }
}

// ä¸šåŠ¡æµç¨‹ï¼š
// å®¢æˆ· â†’ åŠç†ä¸šåŠ¡ï¼ˆactionï¼‰â†’ è°ƒç”¨æŸœå‘˜ï¼ˆmutationï¼‰â†’ æ“ä½œä¿é™©æŸœï¼ˆstateï¼‰
```

---

### å¸¸è§é—®é¢˜è§£ç­”

#### Q1: Getters æ˜¯å†…ç½®çš„å—ï¼Ÿæ€ä¹ˆæ¥çš„ï¼Ÿ

**A**: **ä¸æ˜¯å†…ç½®çš„**ï¼ŒGetters æ˜¯ä½ åœ¨ `createStore({})` ä¸­è‡ªå·±å®šä¹‰çš„ï¼š

```js
// Vuex æä¾›äº† getters è¿™ä¸ª"æ§½ä½"ï¼ˆç±»ä¼¼é“¶è¡Œæä¾›æŸ¥è¯¢çª—å£ï¼‰
createStore({
  getters: {
    // ä½ è‡ªå·±å®šä¹‰å…·ä½“çš„ getterï¼ˆä½ å†³å®šæä¾›å“ªäº›æŸ¥è¯¢æœåŠ¡ï¼‰
    isDarkMode: state => state.isDarkMode,
    isAdmin: state => state.user?.is_admin
  }
})
```

å°±åƒé“¶è¡Œæä¾›äº†"æŸ¥è¯¢çª—å£"çš„ä½ç½®ï¼Œä½†å…·ä½“æä¾›ä»€ä¹ˆæŸ¥è¯¢æœåŠ¡ç”±ä½ å†³å®šã€‚

#### Q2: Getters åœ¨ Mutations é‡Œé¢å—ï¼Ÿ

**A**: **ä¸åœ¨ï¼** å®ƒä»¬æ˜¯**å¹³çº§**çš„ï¼Œéƒ½æ˜¯ `createStore({})` çš„ç›´æ¥å±æ€§ï¼š

```js
createStore({
  state: {},      // å¹³çº§ - ä¿é™©æŸœ
  mutations: {},  // å¹³çº§ - æŸœå‘˜
  actions: {},    // å¹³çº§ - ä¸šåŠ¡æµç¨‹
  getters: {}     // å¹³çº§ - æŸ¥è¯¢çª—å£
})
```

å°±åƒé“¶è¡Œçš„ä¸åŒéƒ¨é—¨ï¼Œå®ƒä»¬åœ¨åŒä¸€å±‚çº§ï¼Œå„å¸å…¶èŒã€‚

#### Q3: ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼Ÿ

**A**: å°±åƒä¸èƒ½è·³è¿‡æŸœå‘˜ç›´æ¥æ‰“å¼€ä¿é™©æŸœä¸€æ ·ã€‚ç›´æ¥ä¿®æ”¹ä¼šå¯¼è‡´ï¼š

```js
// âŒ é”™è¯¯ï¼šç»•è¿‡æŸœå‘˜ç›´æ¥å¼€ä¿é™©æŸœ
store.state.money += 100  
// é—®é¢˜ï¼š
// - ç›‘æ§æ‘„åƒå¤´ï¼ˆDevToolsï¼‰æ²¡è®°å½•
// - ä¸çŸ¥é“æ˜¯è°æ”¹çš„
// - æ— æ³•å›æº¯å†å²
// - è¿åé“¶è¡Œè§„å®š

// âœ… æ­£ç¡®ï¼šé€šè¿‡æŸœå‘˜åŠç†
store.commit('DEPOSIT', 100)
// ä¼˜åŠ¿ï¼š
// - æœ‰å®Œæ•´è®°å½•
// - å¯ä»¥è¿½æº¯è°åœ¨ä»€ä¹ˆæ—¶å€™å­˜äº†å¤šå°‘é’±
// - ç¬¦åˆé“¶è¡Œè§„å®š
```

#### Q4: ä»€ä¹ˆæ—¶å€™ç”¨ Actionï¼Œä»€ä¹ˆæ—¶å€™ç›´æ¥ Commitï¼Ÿ

**A**: 
- **ä½¿ç”¨ Action**ï¼ˆæ¨èï¼‰ï¼š
  - éœ€è¦å¼‚æ­¥æ“ä½œï¼ˆç­‰å¾… API å“åº”ï¼‰
  - åŒ…å«å¤æ‚ä¸šåŠ¡é€»è¾‘
  - éœ€è¦è°ƒç”¨å¤šä¸ª mutation
  - éœ€è¦æ¡ä»¶åˆ¤æ–­
  
  ```js
  // âœ… ç”¨ actionï¼šå¤æ‚ä¸šåŠ¡
  actions: {
    async login({ commit, dispatch }, credentials) {
      const user = await api.login(credentials)  // å¼‚æ­¥
      commit('SET_USER', user)
      commit('SET_TOKEN', user.token)
      dispatch('loadUserData')  // è°ƒç”¨å…¶ä»– action
    }
  }
  ```

- **ç›´æ¥ Commit**ï¼ˆä»…é™ç®€å•åœºæ™¯ï¼‰ï¼š
  - éå¸¸ç®€å•çš„æ“ä½œ
  - æ²¡æœ‰å¼‚æ­¥é€»è¾‘
  - ä¸æ¨èåœ¨ç»„ä»¶ä¸­ä½¿ç”¨
  
  ```js
  // âš ï¸ å¯ä»¥ä½†ä¸æ¨èï¼šå¤ªç®€å•å¯ä»¥ç›´æ¥ commit
  store.commit('SET_ACTIVE_MENU', '/dashboard')
  ```

#### Q5: Mutation å¯ä»¥æ˜¯å¼‚æ­¥çš„å—ï¼Ÿ

**A**: **ç»å¯¹ä¸å¯ä»¥ï¼** Mutation å¿…é¡»æ˜¯åŒæ­¥çš„ï¼š

```js
// âŒ é”™è¯¯ï¼šmutation ä¸­ä½¿ç”¨å¼‚æ­¥
mutations: {
  async SET_USER(state, userId) {
    const user = await fetchUser(userId)  // âŒ æŠ¥é”™ï¼
    state.user = user
  }
}
// é—®é¢˜ï¼šDevTools æ— æ³•å‡†ç¡®è®°å½•çŠ¶æ€å˜åŒ–çš„æ—¶æœº

// âœ… æ­£ç¡®ï¼šaction ä¸­å¤„ç†å¼‚æ­¥
actions: {
  async fetchAndSetUser({ commit }, userId) {
    const user = await fetchUser(userId)  // âœ… å¼‚æ­¥æ“ä½œåœ¨ action
    commit('SET_USER', user)  // âœ… åŒæ­¥ commit
  }
}
```

**ç±»æ¯”**ï¼šæŸœå‘˜å¿…é¡»ç«‹å³æ‰§è¡Œå­˜å–æ¬¾ï¼ˆåŒæ­¥ï¼‰ï¼Œä½†åŠç†ä¸šåŠ¡æµç¨‹å¯ä»¥ç­‰å¾…ï¼ˆå¼‚æ­¥ï¼‰ã€‚

#### Q6: State, Mutations, Actions, Getters æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ

**A**: å®ƒä»¬æ˜¯**å¹³çº§çš„å››å…„å¼Ÿ**ï¼Œå„å¸å…¶èŒï¼š

```
å®¶æ—ç»“æ„ï¼š
â”œâ”€â”€ Stateï¼ˆè€å¤§ï¼‰       - ä¿ç®¡æ•°æ®
â”œâ”€â”€ Mutationsï¼ˆè€äºŒï¼‰   - å”¯ä¸€èƒ½æ”¹æ•°æ®
â”œâ”€â”€ Actionsï¼ˆè€ä¸‰ï¼‰     - å¤„ç†å¤æ‚ä¸šåŠ¡
â””â”€â”€ Gettersï¼ˆè€å››ï¼‰     - æä¾›æŸ¥è¯¢æœåŠ¡

ä¸æ˜¯åµŒå¥—å…³ç³»ï¼Œæ˜¯å…„å¼Ÿå…³ç³»ï¼
```

### æ€»ç»“

- **Vuex ä½ç½®**ï¼š`frontend/src/store/index.js`ï¼ˆçº¦å®šç›®å½•ï¼‰
- **æ³¨å†Œæ–¹å¼**ï¼šåœ¨ `main.js` ä¸­é€šè¿‡ `app.use(store)` å…¨å±€æ³¨å†Œ
- **ç»„ä»¶ä½¿ç”¨**ï¼šé€šè¿‡ `useStore()` è·å–å®ä¾‹
- **Mutation**ï¼šå”¯ä¸€ä¿®æ”¹ state çš„åŒæ­¥æ–¹æ³•ï¼Œå‘½åç”¨å¤§å†™ä¸‹åˆ’çº¿
- **Action**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘å’Œå¼‚æ­¥æ“ä½œï¼Œé€šè¿‡ `commit` è°ƒç”¨ mutation
- **Getter**ï¼šä» state æ´¾ç”Ÿæ•°æ®çš„è®¡ç®—å±æ€§
- **æ•°æ®æµ**ï¼šç»„ä»¶ dispatch action â†’ action commit mutation â†’ mutation ä¿®æ”¹ state â†’ ç»„ä»¶è‡ªåŠ¨æ›´æ–°

---

## é™„å½•ï¼šPromise ä¸ `await` ç”¨æ³•è§£æ

- **`chatAPI.sendMessage` è¿”å›å€¼**ï¼šè¯¥æ–¹æ³•å†…éƒ¨ä½¿ç”¨ Axios å‘é€ HTTP è¯·æ±‚ï¼Œå› æ­¤è¿”å›çš„æ˜¯ä¸€ä¸ª Promiseã€‚Promise æ˜¯"å°†åœ¨æœªæ¥æŸä¸ªæ—¶åˆ»å¾—åˆ°ç»“æœ"çš„å ä½å¯¹è±¡ï¼ŒçŠ¶æ€ä» `pending`ï¼ˆè¿›è¡Œä¸­ï¼‰è½¬ä¸º `fulfilled`ï¼ˆæˆåŠŸï¼‰æˆ– `rejected`ï¼ˆå¤±è´¥ï¼‰ã€‚
- **`await` çš„ä½œç”¨**ï¼š`await` åªèƒ½å‡ºç°åœ¨ `async` å‡½æ•°å†…ã€‚å½“æ‰§è¡Œåˆ° `await chatAPI.sendMessage(...)` æ—¶ï¼Œå½“å‰å‡½æ•°ä¼šè¢«æŒ‚èµ·ï¼ŒæŠŠæ‰§è¡Œæƒäº¤è¿˜äº‹ä»¶å¾ªç¯ï¼Œç­‰åˆ° Promise å˜ä¸º `fulfilled` åå†ç»§ç»­å¾€ä¸‹èµ°ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½åƒå†™åŒæ­¥ä»£ç ä¸€æ ·ç›´æ¥æ‹¿åˆ°å“åº”ç»“æœï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨å†™ `.then()`ã€‚
- **èµ‹å€¼è¯­å¥æœ¬è´¨**ï¼š

  ```js
  const savedUserMessage = await chatAPI.sendMessage({ ... })
  ```

  ä¸Šé¢ä¸€è¡Œå¯ä»¥ç†è§£ä¸º"è°ƒç”¨ `chatAPI.sendMessage`ï¼Œç­‰å¾… Promise resolveï¼Œå¹¶æŠŠè¿”å›çš„å“åº”å¯¹è±¡èµ‹å€¼ç»™ `savedUserMessage`"ã€‚åç»­å°±å¯ä»¥ç›´æ¥è¯» `savedUserMessage.data.id` ç­‰å­—æ®µã€‚å¦‚æœçœç•¥ `await`ï¼Œå˜é‡æ¥æ”¶åˆ°çš„æ˜¯ Promise æœ¬èº«ï¼Œå¿…é¡»é¢å¤– `.then(res => res.data)` æ‰èƒ½å–å¾—çœŸæ­£æ•°æ®ã€‚
- **ä¸ºä»€ä¹ˆè¿™ä¸æ˜¯é˜»å¡**ï¼šJavaScript è¿è¡Œåœ¨å•çº¿ç¨‹äº‹ä»¶å¾ªç¯æ¨¡å‹ä¸‹ï¼Œ`await` ä¼šæš‚åœå½“å‰å‡½æ•°çš„åç»­è¯­å¥ï¼Œä½†ä¸ä¼šé”æ­» UIã€‚Promise æŒ‚èµ·æœŸé—´ï¼Œæµè§ˆå™¨ä»å¯æ¸²æŸ“ã€å“åº”ç”¨æˆ·äº¤äº’ã€‚ç­‰ç½‘ç»œè¯·æ±‚è¿”å›ï¼Œäº‹ä»¶å¾ªç¯ä¼šæŠŠè¯¥å¼‚æ­¥å‡½æ•°é‡æ–°æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œåç»­é€»è¾‘ã€‚è¿™ä¸ Python `asyncio` é‡Œ"`await` å‡ºè®©æ§åˆ¶æƒ"æ˜¯åŒä¸€ä¸ªæ€æƒ³ï¼Œåªæ˜¯æœ¯è¯­ä¸åŒã€‚
- **é”™è¯¯å¤„ç†**ï¼šè‹¥ `chatAPI.sendMessage` è¢«æ‹’ç»ï¼ˆPromise rejectedï¼‰ï¼Œ`await` ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ç”¨ `try...catch` æ•è·å¹¶åšæç¤ºæˆ–é‡è¯•ã€‚

